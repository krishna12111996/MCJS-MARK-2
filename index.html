<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competition Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        .timer-bell { animation: ring 0.5s ease-in-out; }
        @keyframes ring {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
        }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 50%, #581c87 100%);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .nav-btn {
            transition: all 0.3s ease;
        }
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .portal-card {
            transition: all 0.3s ease;
        }
        .portal-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }
        .score-dropdown {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        .timer-display {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Clean Navigation Header -->
    <nav class="glass-card shadow-xl">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-gray-800">‚öñÔ∏è Competition Management System</h1>
                </div>
                <div class="flex items-center space-x-2">
                    <button onclick="showPortal('home')" class="nav-btn bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 text-sm font-medium">Home</button>
                    <button onclick="showPortal('admin')" class="nav-btn bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 text-sm font-medium">Admin</button>
                    <button onclick="showPortal('judge')" class="nav-btn bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 text-sm font-medium">Judge</button>
                    <button onclick="showPortal('manager')" class="nav-btn bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 text-sm font-medium">Manager</button>
                    <button onclick="showPortal('dashboard')" class="nav-btn bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 text-sm font-medium">Dashboard</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Home Portal -->
    <div id="home-portal" class="portal active max-w-6xl mx-auto p-8">
        <div class="text-center mb-12">
            <h2 class="text-5xl font-bold text-white mb-4">Welcome to MCJS</h2>
            <p class="text-xl text-white/80 mb-8">Moot Court Judging System - Professional Competition Management</p>
        </div>
        
        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="portal-card glass-card rounded-xl p-6 text-center cursor-pointer" onclick="showPortal('admin')">
                <div class="text-4xl mb-4">üîë</div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">Admin Portal</h3>
                <p class="text-gray-600 text-sm">Create competitions and manage court assignments</p>
            </div>
            
            <div class="portal-card glass-card rounded-xl p-6 text-center cursor-pointer" onclick="showPortal('judge')">
                <div class="text-4xl mb-4">‚öñÔ∏è</div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">Judge Portal</h3>
                <p class="text-gray-600 text-sm">Score teams with OMR-style evaluation system</p>
            </div>
            
            <div class="portal-card glass-card rounded-xl p-6 text-center cursor-pointer" onclick="showPortal('manager')">
                <div class="text-4xl mb-4">‚è±Ô∏è</div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">Court Manager</h3>
                <p class="text-gray-600 text-sm">Manage timekeeping with precision controls</p>
            </div>
            
            <div class="portal-card glass-card rounded-xl p-6 text-center cursor-pointer" onclick="showPortal('dashboard')">
                <div class="text-4xl mb-4">üìä</div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">Dashboard</h3>
                <p class="text-gray-600 text-sm">View rankings and export reports</p>
            </div>
        </div>
        
        <!-- Copyright Notice -->
        <div class="text-center mt-12 pt-8 border-t border-white/20">
            <p class="text-white/70 text-sm">
                ¬© Copyright by <span class="font-semibold text-white">VKT KRISHNADAS UNNI</span> - 
                <span class="font-semibold text-white">SOUNDARYA COLLEGE OF LAW</span>
            </p>
        </div>
    </div>

    <!-- Admin Portal -->
    <div id="admin-portal" class="portal hidden max-w-6xl mx-auto p-8">
        <div class="glass-card rounded-xl p-8">
            <h2 class="text-3xl font-bold text-green-700 mb-6 text-center">üîë Admin Portal</h2>
            
            <div class="mb-6">
                <div class="flex space-x-4 border-b">
                    <button onclick="showAdminTab('create')" class="admin-tab-btn active px-4 py-2 font-medium text-green-600 border-b-2 border-green-600">Create Competition</button>
                    <button onclick="showAdminTab('assign')" class="admin-tab-btn px-4 py-2 font-medium text-gray-500 hover:text-green-600">Court Assignment</button>
                    <button onclick="showAdminTab('manage')" class="admin-tab-btn px-4 py-2 font-medium text-gray-500 hover:text-green-600">Manage Assignments</button>
                </div>
            </div>

            <!-- Create Competition Tab -->
            <div id="admin-create" class="admin-tab active">
                <form id="competition-form" class="space-y-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">College Name</label>
                            <input type="text" id="college-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Competition Name</label>
                            <input type="text" id="competition-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                            <input type="date" id="competition-date" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Number of Teams</label>
                            <input type="number" id="num-teams" min="2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Number of Courtrooms</label>
                            <input type="number" id="num-courtrooms" min="1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Rounds</label>
                        <div class="grid grid-cols-3 md:grid-cols-6 gap-2">
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="prelims1" class="rounded text-green-600">
                                <span class="text-sm">Prelims 1</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="prelims2" class="rounded text-green-600">
                                <span class="text-sm">Prelims 2</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="octa" class="rounded text-green-600">
                                <span class="text-sm">Octa</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="quarters" class="rounded text-green-600">
                                <span class="text-sm">Quarters</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="semi" class="rounded text-green-600">
                                <span class="text-sm">Semi</span>
                            </label>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="finals" class="rounded text-green-600">
                                <span class="text-sm">Finals</span>
                            </label>
                        </div>
                    </div>
                    
                    <button type="submit" class="w-full bg-green-600 text-white py-3 px-6 rounded-lg hover:bg-green-700 transition-colors font-medium">Create Competition</button>
                </form>
            </div>

            <!-- Court Assignment Tab -->
            <div id="admin-assign" class="admin-tab hidden">
                <form id="court-assignment-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Select Competition</label>
                        <select id="select-competition" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                            <option value="">Choose a competition...</option>
                        </select>
                    </div>
                    
                    <div class="grid md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Court Number</label>
                            <input type="number" id="court-number" min="1" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Round</label>
                            <select id="court-round" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                                <option value="">Select Round...</option>
                                <option value="prelims1">Prelims 1</option>
                                <option value="prelims2">Prelims 2</option>
                                <option value="octa">Octa Finals</option>
                                <option value="quarters">Quarter Finals</option>
                                <option value="semi">Semi Finals</option>
                                <option value="finals">Finals</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Court Password</label>
                            <input type="password" id="court-password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Number of Judges (1-5)</label>
                        <input type="number" id="num-judges" min="1" max="5" value="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                    </div>
                    
                    <div id="judges-container" class="space-y-3">
                        <!-- Judge inputs will be generated here -->
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Petitioner Team Code</label>
                            <input type="text" id="petitioner-team" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Respondent Team Code</label>
                            <input type="text" id="respondent-team" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Court Manager Name</label>
                            <input type="text" id="manager-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Manager Password</label>
                            <input type="password" id="manager-password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                        </div>
                    </div>
                    
                    <button type="submit" class="w-full bg-green-600 text-white py-3 px-6 rounded-lg hover:bg-green-700 transition-colors font-medium">Assign Court</button>
                </form>
            </div>

            <!-- Manage Assignments Tab -->
            <div id="admin-manage" class="admin-tab hidden">
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Filter by Round</label>
                    <select id="manage-round-filter" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" onchange="filterAssignmentsByRound()">
                        <option value="">All Rounds</option>
                        <option value="prelims1">Prelims 1</option>
                        <option value="prelims2">Prelims 2</option>
                        <option value="octa">Octa Finals</option>
                        <option value="quarters">Quarter Finals</option>
                        <option value="semi">Semi Finals</option>
                        <option value="finals">Finals</option>
                    </select>
                </div>
                <div id="assignments-list" class="space-y-4">
                    <!-- Assignments will be displayed here -->
                </div>
            </div>
        </div>
        
        <!-- Copyright Notice -->
        <div class="text-center mt-12 pt-8 border-t border-white/20">
            <p class="text-white/70 text-sm">
                ¬© Copyright by <span class="font-semibold text-white">VKT KRISHNADAS UNNI</span> - 
                <span class="font-semibold text-white">SOUNDARYA COLLEGE OF LAW</span>
            </p>
        </div>
    </div>

    <!-- Judge Portal -->
    <div id="judge-portal" class="portal hidden max-w-4xl mx-auto p-8">
        <div class="glass-card rounded-xl p-8">
            <h2 class="text-3xl font-bold text-purple-700 mb-6 text-center">‚öñÔ∏è Judge Portal</h2>
            
            <!-- Judge Login -->
            <div id="judge-login" class="space-y-4">
                <h3 class="text-xl font-bold mb-4">Secure Judge Login</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Competition Name</label>
                        <select id="judge-competition" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" required>
                            <option value="">Select Competition...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Courtroom Number</label>
                        <select id="judge-courtroom" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" required>
                            <option value="">Select Courtroom...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Round</label>
                        <select id="judge-round" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" required>
                            <option value="">Select Round...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Courtroom Password</label>
                        <input type="password" id="judge-password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Judge Name</label>
                    <select id="judge-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500" required>
                        <option value="">Select Your Name...</option>
                    </select>
                </div>
                <button onclick="judgeLogin()" class="w-full bg-purple-600 text-white py-3 px-6 rounded-lg hover:bg-purple-700 transition-colors font-medium">Login</button>
            </div>

            <!-- Judge Scoring -->
            <div id="judge-scoring" class="hidden">
                <div class="mb-6">
                    <div id="court-info" class="bg-purple-50 p-4 rounded-lg mb-4"></div>
                    
                    <!-- Team Tabs -->
                    <div class="flex space-x-4 border-b mb-6">
                        <button id="petitioner-tab" onclick="showTeamTab('petitioner')" class="team-tab-btn active px-6 py-3 font-medium text-blue-600 border-b-2 border-blue-600">Petitioner Team</button>
                        <button id="respondent-tab" onclick="showTeamTab('respondent')" class="team-tab-btn px-6 py-3 font-medium text-gray-400 cursor-not-allowed" disabled>Respondent Team</button>
                    </div>
                </div>
                
                <!-- Petitioner Scoring Form -->
                <div id="petitioner-form" class="team-form active">
                    <div class="bg-blue-50 p-6 rounded-lg">
                        <h4 class="text-lg font-bold text-blue-700 mb-4">Petitioner Team Scoring</h4>
                        <div id="petitioner-speakers" class="space-y-6">
                            <!-- Speaker forms will be generated here -->
                        </div>
                        <button onclick="submitTeamScores('petitioner')" id="submit-petitioner" class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors font-medium mt-6" disabled>Submit Petitioner Scores</button>
                    </div>
                </div>
                
                <!-- Respondent Scoring Form -->
                <div id="respondent-form" class="team-form hidden">
                    <div class="bg-red-50 p-6 rounded-lg">
                        <h4 class="text-lg font-bold text-red-700 mb-4">Respondent Team Scoring</h4>
                        <div id="respondent-speakers" class="space-y-6">
                            <!-- Speaker forms will be generated here -->
                        </div>
                        <button onclick="submitTeamScores('respondent')" id="submit-respondent" class="w-full bg-red-600 text-white py-3 px-6 rounded-lg hover:bg-red-700 transition-colors font-medium mt-6" disabled>Submit Respondent Scores</button>
                    </div>
                </div>
            </div>

            <!-- Judge Thank You -->
            <div id="judge-thankyou" class="hidden text-center">
                <div class="text-6xl mb-4">‚úÖ</div>
                <h3 class="text-2xl font-bold text-green-600 mb-2">Scoring Complete!</h3>
                <p class="text-gray-600 mb-4">Both teams have been scored successfully.</p>
                <button onclick="resetJudgePortal()" class="bg-purple-600 text-white py-3 px-6 rounded-lg hover:bg-purple-700 transition-colors font-medium">Score Another Court</button>
            </div>
        </div>
        
        <!-- Copyright Notice -->
        <div class="text-center mt-12 pt-8 border-t border-white/20">
            <p class="text-white/70 text-sm">
                ¬© Copyright by <span class="font-semibold text-white">VKT KRISHNADAS UNNI</span> - 
                <span class="font-semibold text-white">SOUNDARYA COLLEGE OF LAW</span>
            </p>
        </div>
    </div>

    <!-- Court Manager Portal -->
    <div id="manager-portal" class="portal hidden max-w-5xl mx-auto p-8">
        <div class="glass-card rounded-xl p-8">
            <h2 class="text-3xl font-bold text-orange-700 mb-6 text-center">‚è±Ô∏è Court Manager Portal</h2>
            
            <!-- Manager Login -->
            <div id="manager-login" class="space-y-4">
                <h3 class="text-xl font-bold mb-4">Manager Login</h3>
                <div class="grid md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Manager Name</label>
                        <select id="manager-login-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 max-h-40 overflow-y-auto" required>
                            <option value="">Select Manager...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="manager-login-password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Round</label>
                        <select id="manager-round" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500" required>
                            <option value="">Select Round...</option>
                            <option value="prelims1">Prelims 1</option>
                            <option value="prelims2">Prelims 2</option>
                            <option value="octa">Octa Finals</option>
                            <option value="quarters">Quarter Finals</option>
                            <option value="semi">Semi Finals</option>
                            <option value="finals">Finals</option>
                        </select>
                    </div>
                </div>
                <button onclick="managerLogin()" class="w-full bg-orange-600 text-white py-3 px-6 rounded-lg hover:bg-orange-700 transition-colors font-medium">Login</button>
            </div>

            <!-- Manager Timekeeping -->
            <div id="manager-timekeeping" class="hidden">
                <div class="mb-6">
                    <div id="manager-court-info" class="bg-orange-50 p-4 rounded-lg mb-4"></div>
                </div>
                
                <!-- Time Allocation Setup -->
                <div id="time-allocation" class="mb-8">
                    <h3 class="text-xl font-bold mb-4">Time Allocation Setup (30 minutes per team)</h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <!-- Petitioner Timing -->
                        <div class="bg-blue-50 p-6 rounded-lg">
                            <h4 class="text-lg font-bold text-blue-700 mb-4">Petitioner Team</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Speaker 1 (minutes)</label>
                                    <input type="number" id="pet-speaker1-time" min="1" max="25" class="w-full p-2 border border-gray-300 rounded-lg" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Speaker 2 (minutes)</label>
                                    <input type="number" id="pet-speaker2-time" min="1" max="25" class="w-full p-2 border border-gray-300 rounded-lg" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Rebuttal (minutes)</label>
                                    <input type="number" id="pet-rebuttal-time" min="1" max="15" class="w-full p-2 border border-gray-300 rounded-lg" required>
                                </div>
                                <div class="text-sm font-medium">
                                    Total: <span id="pet-total-time" class="font-bold">0</span> minutes
                                    <span id="pet-total-status" class="ml-2"></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Respondent Timing -->
                        <div class="bg-red-50 p-6 rounded-lg">
                            <h4 class="text-lg font-bold text-red-700 mb-4">Respondent Team</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Speaker 1 (minutes)</label>
                                    <input type="number" id="res-speaker1-time" min="1" max="25" class="w-full p-2 border border-gray-300 rounded-lg" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Speaker 2 (minutes)</label>
                                    <input type="number" id="res-speaker2-time" min="1" max="25" class="w-full p-2 border border-gray-300 rounded-lg" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Sur-Rebuttal (minutes)</label>
                                    <input type="number" id="res-rebuttal-time" min="1" max="15" class="w-full p-2 border border-gray-300 rounded-lg" required>
                                </div>
                                <div class="text-sm font-medium">
                                    Total: <span id="res-total-time" class="font-bold">0</span> minutes
                                    <span id="res-total-status" class="ml-2"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 text-center">
                        <button onclick="startTimekeeping()" id="start-timekeeping-btn" class="bg-green-600 text-white py-3 px-8 rounded-lg hover:bg-green-700 transition-colors font-medium" disabled>Start Timekeeping</button>
                    </div>
                </div>
                
                <!-- Timekeeping Panel -->
                <div id="timekeeping-panel" class="hidden">
                    <h3 class="text-xl font-bold mb-4">Timekeeping Panel</h3>
                    
                    <!-- Timer Display -->
                    <div class="timer-display text-white p-8 rounded-lg mb-6 text-center">
                        <div class="text-6xl font-bold mb-2" id="timer-clock">00:00:00</div>
                        <div class="text-xl mb-4" id="current-speaker">Ready to start</div>
                        <div class="text-lg mb-2" id="speaker-progress">Speaker 1 of 6</div>
                        <div class="text-lg font-bold" id="timer-indicator"></div>
                    </div>
                    
                    <!-- Timer Controls -->
                    <div class="flex justify-center space-x-4 mb-6">
                        <button onclick="startTimer()" id="start-timer-btn" class="bg-green-600 text-white py-3 px-6 rounded-lg hover:bg-green-700 transition-colors font-medium">Start</button>
                        <button onclick="stopTimer()" id="stop-timer-btn" class="bg-red-600 text-white py-3 px-6 rounded-lg hover:bg-red-700 transition-colors font-medium" disabled>Stop</button>
                        <button onclick="nextSpeaker()" id="next-speaker-btn" class="bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors font-medium" disabled>Next Speaker</button>
                    </div>
                    
                    <!-- Extra Time Controls -->
                    <div class="flex justify-center space-x-4 mb-6">
                        <button onclick="addExtraTime(120)" class="bg-yellow-600 text-white py-2 px-4 rounded-lg hover:bg-yellow-700 transition-colors">+2 min</button>
                        <button onclick="addExtraTime(30)" class="bg-yellow-600 text-white py-2 px-4 rounded-lg hover:bg-yellow-700 transition-colors">+30 sec</button>
                    </div>
                    
                    <!-- Submit Button (appears only after all 6 speakers complete) -->
                    <div class="text-center">
                        <button onclick="submitTimekeeping()" id="submit-timekeeping-btn" class="hidden bg-orange-600 text-white py-3 px-8 rounded-lg hover:bg-orange-700 transition-colors font-medium">Submit Timekeeping Data</button>
                        <div id="submission-status" class="mt-4 text-sm text-gray-600"></div>
                    </div>
                </div>
            </div>

            <!-- Manager Thank You -->
            <div id="manager-thankyou" class="hidden text-center">
                <div class="text-6xl mb-4">‚úÖ</div>
                <h3 class="text-2xl font-bold text-green-600 mb-2">Timekeeping Complete!</h3>
                <p class="text-gray-600 mb-4">All timing data has been submitted successfully.</p>
                <button onclick="resetManagerPortal()" class="bg-orange-600 text-white py-3 px-6 rounded-lg hover:bg-orange-700 transition-colors font-medium">Manage Another Court</button>
            </div>
        </div>
        
        <!-- Copyright Notice -->
        <div class="text-center mt-12 pt-8 border-t border-white/20">
            <p class="text-white/70 text-sm">
                ¬© Copyright by <span class="font-semibold text-white">VKT KRISHNADAS UNNI</span> - 
                <span class="font-semibold text-white">SOUNDARYA COLLEGE OF LAW</span>
            </p>
        </div>
    </div>

    <!-- Dashboard Portal -->
    <div id="dashboard-portal" class="portal hidden max-w-6xl mx-auto p-8">
        <div class="glass-card rounded-xl p-8">
            <h2 class="text-3xl font-bold text-indigo-700 mb-6 text-center">üìä Dashboard</h2>
            
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-1">Select Competition</label>
                <select id="dashboard-competition" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" onchange="loadDashboard()">
                    <option value="">Choose a competition...</option>
                </select>
            </div>
            
            <div id="dashboard-content" class="hidden">
                <div class="mb-6">
                    <div class="flex space-x-4 border-b" id="round-tabs">
                        <!-- Round tabs will be generated here -->
                    </div>
                </div>
                
                <div id="rankings-content">
                    <!-- Rankings will be displayed here -->
                </div>
            </div>
        </div>
        
        <!-- Copyright Notice -->
        <div class="text-center mt-12 pt-8 border-t border-white/20">
            <p class="text-white/70 text-sm">
                ¬© Copyright by <span class="font-semibold text-white">VKT KRISHNADAS UNNI</span> - 
                <span class="font-semibold text-white">SOUNDARYA COLLEGE OF LAW</span>
            </p>
        </div>
    </div>

    <script>
        // Global variables
        let competitions = JSON.parse(localStorage.getItem('competitions') || '[]');
        let courtAssignments = JSON.parse(localStorage.getItem('courtAssignments') || '[]');
        let judgeScores = JSON.parse(localStorage.getItem('judgeScores') || '[]');
        let timekeepingData = JSON.parse(localStorage.getItem('timekeepingData') || '[]');
        
        let currentTimer = null;
        let timerState = {
            currentSpeaker: 0,
            timeRemaining: 0,
            speakers: [],
            extraTime: 0,
            isRunning: false,
            startTime: null,
            speakerStartTimes: [],
            speakerEndTimes: []
        };

        let currentJudgeSession = {
            petitionerSubmitted: false,
            respondentSubmitted: false,
            assignment: null
        };

        // Navigation functions
        function showPortal(portalName) {
            document.querySelectorAll('.portal').forEach(portal => {
                portal.classList.add('hidden');
                portal.classList.remove('active');
            });
            
            document.getElementById(portalName + '-portal').classList.remove('hidden');
            document.getElementById(portalName + '-portal').classList.add('active', 'fade-in');
            
            if (portalName === 'admin') loadCompetitionsForAssignment();
            if (portalName === 'judge') loadCompetitionsForJudge();
            if (portalName === 'manager') loadManagersForLogin();
            if (portalName === 'dashboard') loadCompetitionsForDashboard();
        }

        // Admin Portal Functions
        function showAdminTab(tabName) {
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.add('hidden');
                tab.classList.remove('active');
            });
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.classList.remove('active', 'text-green-600', 'border-green-600');
                btn.classList.add('text-gray-500');
            });
            
            document.getElementById('admin-' + tabName).classList.remove('hidden');
            document.getElementById('admin-' + tabName).classList.add('active');
            
            event.target.classList.add('active', 'text-green-600', 'border-green-600');
            event.target.classList.remove('text-gray-500');
            
            if (tabName === 'manage') loadAssignments();
        }

        // Competition creation
        document.getElementById('competition-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const competition = {
                id: Date.now(),
                collegeName: document.getElementById('college-name').value,
                competitionName: document.getElementById('competition-name').value,
                date: document.getElementById('competition-date').value,
                numTeams: parseInt(document.getElementById('num-teams').value),
                numCourtrooms: parseInt(document.getElementById('num-courtrooms').value),
                rounds: {
                    prelims1: document.getElementById('prelims1').checked,
                    prelims2: document.getElementById('prelims2').checked,
                    octa: document.getElementById('octa').checked,
                    quarters: document.getElementById('quarters').checked,
                    semi: document.getElementById('semi').checked,
                    finals: document.getElementById('finals').checked
                }
            };
            
            competitions.push(competition);
            localStorage.setItem('competitions', JSON.stringify(competitions));
            
            alert('Competition created successfully!');
            this.reset();
            loadCompetitionsForAssignment();
        });

        // Generate judge inputs
        document.getElementById('num-judges').addEventListener('input', function() {
            const numJudges = parseInt(this.value);
            const container = document.getElementById('judges-container');
            container.innerHTML = '';
            
            for (let i = 1; i <= numJudges; i++) {
                const judgeDiv = document.createElement('div');
                judgeDiv.className = 'grid grid-cols-2 gap-4';
                judgeDiv.innerHTML = `
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Judge ${i} Title</label>
                        <select class="judge-title w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                            <option value="Mr.">Mr.</option>
                            <option value="Mrs.">Mrs.</option>
                            <option value="Ms.">Ms.</option>
                            <option value="Dr.">Dr.</option>
                            <option value="Prof.">Prof.</option>
                            <option value="Hon.">Hon.</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Judge ${i} Full Name</label>
                        <input type="text" class="judge-name w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500" required>
                    </div>
                `;
                container.appendChild(judgeDiv);
            }
        });

        // Trigger initial judge inputs
        document.getElementById('num-judges').dispatchEvent(new Event('input'));

        // Court assignment
        document.getElementById('court-assignment-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const judges = [];
            const judgeTitles = document.querySelectorAll('.judge-title');
            const judgeNames = document.querySelectorAll('.judge-name');
            
            for (let i = 0; i < judgeTitles.length; i++) {
                judges.push({
                    title: judgeTitles[i].value,
                    name: judgeNames[i].value,
                    fullName: judgeTitles[i].value + ' ' + judgeNames[i].value
                });
            }
            
            const assignment = {
                id: this.dataset.editId ? parseInt(this.dataset.editId) : Date.now(),
                competitionId: document.getElementById('select-competition').value,
                courtNumber: parseInt(document.getElementById('court-number').value),
                round: document.getElementById('court-round').value,
                courtPassword: document.getElementById('court-password').value,
                judges: judges,
                petitionerTeam: document.getElementById('petitioner-team').value,
                respondentTeam: document.getElementById('respondent-team').value,
                managerName: document.getElementById('manager-name').value,
                managerPassword: document.getElementById('manager-password').value
            };
            
            if (this.dataset.editId) {
                // Update existing assignment
                const index = courtAssignments.findIndex(a => a.id == this.dataset.editId);
                if (index !== -1) {
                    courtAssignments[index] = assignment;
                    alert('Court assignment updated successfully!');
                }
                delete this.dataset.editId;
                
                // Reset button
                const submitBtn = this.querySelector('button[type="submit"]');
                submitBtn.textContent = 'Assign Court';
                submitBtn.className = 'w-full bg-green-600 text-white py-3 px-6 rounded-lg hover:bg-green-700 transition-colors font-medium';
            } else {
                // Create new assignment
                courtAssignments.push(assignment);
                alert('Court assigned successfully!');
            }
            
            localStorage.setItem('courtAssignments', JSON.stringify(courtAssignments));
            
            this.reset();
            document.getElementById('judges-container').innerHTML = '';
            document.getElementById('num-judges').dispatchEvent(new Event('input'));
        });

        function loadCompetitionsForAssignment() {
            const select = document.getElementById('select-competition');
            select.innerHTML = '<option value="">Choose a competition...</option>';
            
            competitions.forEach(comp => {
                const option = document.createElement('option');
                option.value = comp.id;
                option.textContent = `${comp.competitionName} - ${comp.collegeName}`;
                select.appendChild(option);
            });
        }

        function loadAssignments() {
            const container = document.getElementById('assignments-list');
            const selectedRound = document.getElementById('manage-round-filter').value;
            container.innerHTML = '';
            
            let filteredAssignments = courtAssignments;
            if (selectedRound) {
                filteredAssignments = courtAssignments.filter(a => a.round === selectedRound);
            }
            
            if (filteredAssignments.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No court assignments found for the selected criteria.</p>';
                return;
            }
            
            filteredAssignments.forEach(assignment => {
                const competition = competitions.find(c => c.id == assignment.competitionId);
                const assignmentDiv = document.createElement('div');
                assignmentDiv.className = 'bg-gray-50 p-4 rounded-lg border';
                assignmentDiv.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-bold text-lg">${competition ? competition.competitionName : 'Unknown Competition'}</h4>
                            <p class="text-gray-600">Court ${assignment.courtNumber} - ${assignment.round}</p>
                            <p class="text-sm text-gray-500">Petitioner: ${assignment.petitionerTeam} vs Respondent: ${assignment.respondentTeam}</p>
                            <p class="text-sm text-gray-500">Manager: ${assignment.managerName}</p>
                            <p class="text-sm text-gray-500">Judges: ${assignment.judges.map(j => j.fullName).join(', ')}</p>
                        </div>
                        <div class="space-x-2">
                            <button onclick="editAssignment(${assignment.id})" class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition-colors">Edit</button>
                            <button onclick="deleteAssignment(${assignment.id})" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition-colors">Delete</button>
                        </div>
                    </div>
                `;
                container.appendChild(assignmentDiv);
            });
        }

        function filterAssignmentsByRound() {
            loadAssignments();
        }

        function editAssignment(id) {
            const assignment = courtAssignments.find(a => a.id === id);
            if (!assignment) return;
            
            // Switch to assignment tab and populate form
            showAdminTab('assign');
            
            // Populate form with existing data
            document.getElementById('select-competition').value = assignment.competitionId;
            document.getElementById('court-number').value = assignment.courtNumber;
            document.getElementById('court-round').value = assignment.round;
            document.getElementById('court-password').value = assignment.courtPassword;
            document.getElementById('num-judges').value = assignment.judges.length;
            document.getElementById('num-judges').dispatchEvent(new Event('input'));
            
            // Wait for judge inputs to be generated, then populate
            setTimeout(() => {
                const judgeTitles = document.querySelectorAll('.judge-title');
                const judgeNames = document.querySelectorAll('.judge-name');
                
                assignment.judges.forEach((judge, index) => {
                    if (judgeTitles[index]) judgeTitles[index].value = judge.title;
                    if (judgeNames[index]) judgeNames[index].value = judge.name;
                });
            }, 100);
            
            document.getElementById('petitioner-team').value = assignment.petitionerTeam;
            document.getElementById('respondent-team').value = assignment.respondentTeam;
            document.getElementById('manager-name').value = assignment.managerName;
            document.getElementById('manager-password').value = assignment.managerPassword;
            
            // Store the ID for updating
            document.getElementById('court-assignment-form').dataset.editId = id;
            
            // Change button text
            const submitBtn = document.querySelector('#court-assignment-form button[type="submit"]');
            submitBtn.textContent = 'Update Assignment';
            submitBtn.className = 'w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors font-medium';
        }

        function deleteAssignment(id) {
            if (confirm('Are you sure you want to delete this assignment? This will also delete all associated scores and timing data.')) {
                // Remove the assignment
                courtAssignments = courtAssignments.filter(a => a.id !== id);
                localStorage.setItem('courtAssignments', JSON.stringify(courtAssignments));
                
                // Remove associated judge scores
                judgeScores = judgeScores.filter(s => s.assignmentId !== id);
                localStorage.setItem('judgeScores', JSON.stringify(judgeScores));
                
                // Remove associated timekeeping data
                timekeepingData = timekeepingData.filter(t => t.assignmentId !== id);
                localStorage.setItem('timekeepingData', JSON.stringify(timekeepingData));
                
                loadAssignments();
                alert('Assignment and all associated data deleted successfully!');
            }
        }

        // Judge Portal Functions
        function loadCompetitionsForJudge() {
            const select = document.getElementById('judge-competition');
            select.innerHTML = '<option value="">Select Competition...</option>';
            
            competitions.forEach(comp => {
                const option = document.createElement('option');
                option.value = comp.id;
                option.textContent = `${comp.competitionName} - ${comp.collegeName}`;
                select.appendChild(option);
            });
        }

        document.getElementById('judge-competition').addEventListener('change', function() {
            const competitionId = this.value;
            const courtroomSelect = document.getElementById('judge-courtroom');
            const roundSelect = document.getElementById('judge-round');
            
            courtroomSelect.innerHTML = '<option value="">Select Courtroom...</option>';
            roundSelect.innerHTML = '<option value="">Select Round...</option>';
            
            if (!competitionId) return;
            
            const assignments = courtAssignments.filter(a => a.competitionId == competitionId);
            const courtrooms = [...new Set(assignments.map(a => a.courtNumber))];
            const rounds = [...new Set(assignments.map(a => a.round))];
            
            courtrooms.forEach(court => {
                const option = document.createElement('option');
                option.value = court;
                option.textContent = `Court ${court}`;
                courtroomSelect.appendChild(option);
            });
            
            rounds.forEach(round => {
                const option = document.createElement('option');
                option.value = round;
                option.textContent = round.charAt(0).toUpperCase() + round.slice(1);
                roundSelect.appendChild(option);
            });
        });

        document.getElementById('judge-courtroom').addEventListener('change', updateJudgeNames);
        document.getElementById('judge-round').addEventListener('change', updateJudgeNames);

        function updateJudgeNames() {
            const competitionId = document.getElementById('judge-competition').value;
            const courtNumber = document.getElementById('judge-courtroom').value;
            const round = document.getElementById('judge-round').value;
            const judgeSelect = document.getElementById('judge-name');
            
            judgeSelect.innerHTML = '<option value="">Select Your Name...</option>';
            
            if (!competitionId || !courtNumber || !round) return;
            
            const assignment = courtAssignments.find(a => 
                a.competitionId == competitionId && 
                a.courtNumber == courtNumber && 
                a.round === round
            );
            
            if (assignment) {
                assignment.judges.forEach(judge => {
                    const option = document.createElement('option');
                    option.value = judge.fullName;
                    option.textContent = judge.fullName;
                    judgeSelect.appendChild(option);
                });
            }
        }

        function judgeLogin() {
            const competitionId = document.getElementById('judge-competition').value;
            const courtNumber = document.getElementById('judge-courtroom').value;
            const round = document.getElementById('judge-round').value;
            const password = document.getElementById('judge-password').value;
            const judgeName = document.getElementById('judge-name').value;
            
            if (!competitionId || !courtNumber || !round || !password || !judgeName) {
                alert('Please fill in all fields');
                return;
            }
            
            // Find matching assignment
            const assignment = courtAssignments.find(a => 
                a.competitionId == competitionId && 
                a.courtNumber == courtNumber && 
                a.round === round &&
                a.courtPassword === password
            );
            
            if (!assignment) {
                alert('Invalid credentials or court assignment not found');
                return;
            }
            
            // Check if judge is assigned to this court
            const judgeAssigned = assignment.judges.some(j => j.fullName === judgeName);
            if (!judgeAssigned) {
                alert('You are not assigned to this courtroom');
                return;
            }
            
            const competition = competitions.find(c => c.id == competitionId);
            
            // Store current session
            currentJudgeSession.assignment = assignment;
            currentJudgeSession.petitionerSubmitted = false;
            currentJudgeSession.respondentSubmitted = false;
            
            // Show scoring interface
            document.getElementById('judge-login').classList.add('hidden');
            document.getElementById('judge-scoring').classList.remove('hidden');
            
            // Populate court info
            document.getElementById('court-info').innerHTML = `
                <div class="grid md:grid-cols-4 gap-4 text-sm">
                    <div><strong>Competition:</strong> ${competition.competitionName}</div>
                    <div><strong>Court:</strong> ${assignment.courtNumber}</div>
                    <div><strong>Round:</strong> ${assignment.round}</div>
                    <div><strong>Judge:</strong> ${judgeName}</div>
                </div>
                <div class="grid md:grid-cols-2 gap-4 mt-2 text-sm">
                    <div><strong>Petitioner:</strong> ${assignment.petitionerTeam}</div>
                    <div><strong>Respondent:</strong> ${assignment.respondentTeam}</div>
                </div>
            `;
            
            // Generate scoring forms
            generateScoringForms(assignment);
        }

        function generateScoringForms(assignment) {
            const petitionerContainer = document.getElementById('petitioner-speakers');
            const respondentContainer = document.getElementById('respondent-speakers');
            
            // Clear containers
            petitionerContainer.innerHTML = '';
            respondentContainer.innerHTML = '';
            
            // Generate forms for both teams
            ['petitioner', 'respondent'].forEach(team => {
                const container = team === 'petitioner' ? petitionerContainer : respondentContainer;
                
                for (let speaker = 1; speaker <= 2; speaker++) {
                    const speakerDiv = document.createElement('div');
                    speakerDiv.className = 'bg-white p-4 rounded-lg border shadow-sm';
                    speakerDiv.innerHTML = `
                        <h5 class="font-bold mb-3 text-lg">Speaker ${speaker}</h5>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Gender</label>
                            <select name="${team}-speaker${speaker}-gender" class="w-full p-2 border border-gray-300 rounded-lg score-dropdown" required>
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-1 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Perusal of Facts (10 marks)</label>
                                <select name="${team}-speaker${speaker}-perusal" class="w-full p-2 border border-gray-300 rounded-lg score-dropdown" required>
                                    <option value="">Select Score</option>
                                    <option value="1">1 - Poor</option>
                                    <option value="2">2 - Poor</option>
                                    <option value="3">3 - Poor</option>
                                    <option value="4">4 - Average</option>
                                    <option value="5">5 - Average</option>
                                    <option value="6">6 - Good</option>
                                    <option value="7">7 - Good</option>
                                    <option value="8">8 - Excellent</option>
                                    <option value="9">9 - Excellent</option>
                                    <option value="10">10 - Outstanding</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Knowledge and Application of Law (20 marks)</label>
                                <select name="${team}-speaker${speaker}-knowledge" class="w-full p-2 border border-gray-300 rounded-lg score-dropdown" required>
                                    <option value="">Select Score</option>
                                    <option value="10">10 - Good</option>
                                    <option value="11">11 - Good</option>
                                    <option value="12">12 - Good</option>
                                    <option value="13">13 - Good</option>
                                    <option value="14">14 - Good</option>
                                    <option value="15">15 - Excellent</option>
                                    <option value="16">16 - Excellent</option>
                                    <option value="17">17 - Excellent</option>
                                    <option value="18">18 - Excellent</option>
                                    <option value="19">19 - Excellent</option>
                                    <option value="20">20 - Outstanding</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Organization and Presentation (20 marks)</label>
                                <select name="${team}-speaker${speaker}-organization" class="w-full p-2 border border-gray-300 rounded-lg score-dropdown" required>
                                    <option value="">Select Score</option>
                                    <option value="10">10 - Good</option>
                                    <option value="11">11 - Good</option>
                                    <option value="12">12 - Good</option>
                                    <option value="13">13 - Good</option>
                                    <option value="14">14 - Good</option>
                                    <option value="15">15 - Excellent</option>
                                    <option value="16">16 - Excellent</option>
                                    <option value="17">17 - Excellent</option>
                                    <option value="18">18 - Excellent</option>
                                    <option value="19">19 - Excellent</option>
                                    <option value="20">20 - Outstanding</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Clarity of Thought, Legal Reasoning and Analytical Deduction (20 marks)</label>
                                <select name="${team}-speaker${speaker}-clarity" class="w-full p-2 border border-gray-300 rounded-lg score-dropdown" required>
                                    <option value="">Select Score</option>
                                    <option value="10">10 - Good</option>
                                    <option value="11">11 - Good</option>
                                    <option value="12">12 - Good</option>
                                    <option value="13">13 - Good</option>
                                    <option value="14">14 - Good</option>
                                    <option value="15">15 - Excellent</option>
                                    <option value="16">16 - Excellent</option>
                                    <option value="17">17 - Excellent</option>
                                    <option value="18">18 - Excellent</option>
                                    <option value="19">19 - Excellent</option>
                                    <option value="20">20 - Outstanding</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Persuasiveness and Response to Questions (20 marks)</label>
                                <select name="${team}-speaker${speaker}-persuasiveness" class="w-full p-2 border border-gray-300 rounded-lg score-dropdown" required>
                                    <option value="">Select Score</option>
                                    <option value="10">10 - Good</option>
                                    <option value="11">11 - Good</option>
                                    <option value="12">12 - Good</option>
                                    <option value="13">13 - Good</option>
                                    <option value="14">14 - Good</option>
                                    <option value="15">15 - Excellent</option>
                                    <option value="16">16 - Excellent</option>
                                    <option value="17">17 - Excellent</option>
                                    <option value="18">18 - Excellent</option>
                                    <option value="19">19 - Excellent</option>
                                    <option value="20">20 - Outstanding</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Team Coordination and Time Management (10 marks)</label>
                                <select name="${team}-speaker${speaker}-coordination" class="w-full p-2 border border-gray-300 rounded-lg score-dropdown" required>
                                    <option value="">Select Score</option>
                                    <option value="1">1 - Poor</option>
                                    <option value="2">2 - Poor</option>
                                    <option value="3">3 - Poor</option>
                                    <option value="4">4 - Average</option>
                                    <option value="5">5 - Average</option>
                                    <option value="6">6 - Good</option>
                                    <option value="7">7 - Good</option>
                                    <option value="8">8 - Excellent</option>
                                    <option value="9">9 - Excellent</option>
                                    <option value="10">10 - Outstanding</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Courtroom Etiquette (10 marks)</label>
                                <select name="${team}-speaker${speaker}-etiquette" class="w-full p-2 border border-gray-300 rounded-lg score-dropdown" required>
                                    <option value="">Select Score</option>
                                    <option value="1">1 - Poor</option>
                                    <option value="2">2 - Poor</option>
                                    <option value="3">3 - Poor</option>
                                    <option value="4">4 - Average</option>
                                    <option value="5">5 - Average</option>
                                    <option value="6">6 - Good</option>
                                    <option value="7">7 - Good</option>
                                    <option value="8">8 - Excellent</option>
                                    <option value="9">9 - Excellent</option>
                                    <option value="10">10 - Outstanding</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                            <div class="text-sm font-medium">Speaker ${speaker} Total: <span id="${team}-speaker${speaker}-total" class="font-bold text-lg">0</span>/110</div>
                        </div>
                    `;
                    container.appendChild(speakerDiv);
                }
                
                // Add team total
                const teamTotalDiv = document.createElement('div');
                teamTotalDiv.className = 'bg-gray-100 p-4 rounded-lg border-2 border-gray-300';
                teamTotalDiv.innerHTML = `
                    <div class="text-center">
                        <div class="text-lg font-bold">Team Total: <span id="${team}-team-total" class="text-2xl text-blue-600">0</span>/220</div>
                    </div>
                `;
                container.appendChild(teamTotalDiv);
            });
            
            // Add event listeners for score calculation
            document.querySelectorAll('select[name*="speaker"]').forEach(select => {
                select.addEventListener('change', function() {
                    calculateScores();
                    checkFormCompletion();
                });
            });
        }

        function calculateScores() {
            ['petitioner', 'respondent'].forEach(team => {
                let teamTotal = 0;
                
                for (let speaker = 1; speaker <= 2; speaker++) {
                    let speakerTotal = 0;
                    const fields = ['perusal', 'knowledge', 'organization', 'clarity', 'persuasiveness', 'coordination', 'etiquette'];
                    
                    fields.forEach(field => {
                        const select = document.querySelector(`select[name="${team}-speaker${speaker}-${field}"]`);
                        if (select && select.value) {
                            speakerTotal += parseInt(select.value);
                        }
                    });
                    
                    const totalElement = document.getElementById(`${team}-speaker${speaker}-total`);
                    if (totalElement) {
                        totalElement.textContent = speakerTotal;
                    }
                    
                    teamTotal += speakerTotal;
                }
                
                const teamTotalElement = document.getElementById(`${team}-team-total`);
                if (teamTotalElement) {
                    teamTotalElement.textContent = teamTotal;
                }
            });
        }

        function checkFormCompletion() {
            const currentTeam = document.querySelector('.team-form.active').id.includes('petitioner') ? 'petitioner' : 'respondent';
            const submitButton = document.getElementById(`submit-${currentTeam}`);
            
            let allFieldsFilled = true;
            document.querySelectorAll(`select[name*="${currentTeam}-speaker"]`).forEach(select => {
                if (!select.value) {
                    allFieldsFilled = false;
                }
            });
            
            submitButton.disabled = !allFieldsFilled;
        }

        function showTeamTab(team) {
            // Update tab buttons
            document.querySelectorAll('.team-tab-btn').forEach(btn => {
                btn.classList.remove('active', 'text-blue-600', 'border-blue-600', 'text-red-600', 'border-red-600');
                btn.classList.add('text-gray-400');
            });
            
            // Update team forms
            document.querySelectorAll('.team-form').forEach(form => {
                form.classList.add('hidden');
                form.classList.remove('active');
            });
            
            // Show selected team
            const tabButton = document.getElementById(`${team}-tab`);
            const teamForm = document.getElementById(`${team}-form`);
            
            if (team === 'petitioner') {
                tabButton.classList.add('active', 'text-blue-600', 'border-blue-600');
            } else {
                tabButton.classList.add('active', 'text-red-600', 'border-red-600');
            }
            
            teamForm.classList.remove('hidden');
            teamForm.classList.add('active');
        }

        function submitTeamScores(team) {
            const assignment = currentJudgeSession.assignment;
            const judgeName = document.getElementById('judge-name').value;
            
            // Collect all scores for this team
            const teamScores = {};
            document.querySelectorAll(`select[name*="${team}-speaker"]`).forEach(select => {
                teamScores[select.name] = select.value;
            });
            
            // Create score entry
            const scoreEntry = {
                id: Date.now(),
                competitionId: assignment.competitionId,
                assignmentId: assignment.id,
                judgeName: judgeName,
                team: team,
                timestamp: new Date().toISOString(),
                scores: teamScores
            };
            
            judgeScores.push(scoreEntry);
            localStorage.setItem('judgeScores', JSON.stringify(judgeScores));
            
            // Mark team as submitted
            currentJudgeSession[`${team}Submitted`] = true;
            
            // Lock the form
            document.querySelectorAll(`select[name*="${team}-speaker"]`).forEach(select => {
                select.disabled = true;
            });
            document.getElementById(`submit-${team}`).disabled = true;
            document.getElementById(`submit-${team}`).textContent = `${team.charAt(0).toUpperCase() + team.slice(1)} Scores Submitted ‚úì`;
            
            // Enable respondent tab if petitioner is submitted
            if (team === 'petitioner') {
                const respondentTab = document.getElementById('respondent-tab');
                respondentTab.disabled = false;
                respondentTab.classList.remove('text-gray-400', 'cursor-not-allowed');
                respondentTab.classList.add('text-gray-500', 'hover:text-red-600');
                
                // Auto-switch to respondent tab
                showTeamTab('respondent');
                
                alert('Petitioner scores submitted! Please now score the Respondent team.');
            } else {
                // Both teams submitted
                alert('Respondent scores submitted! Scoring complete.');
                
                // Show thank you screen
                document.getElementById('judge-scoring').classList.add('hidden');
                document.getElementById('judge-thankyou').classList.remove('hidden');
            }
        }

        function resetJudgePortal() {
            document.getElementById('judge-thankyou').classList.add('hidden');
            document.getElementById('judge-login').classList.remove('hidden');
            
            // Reset form
            document.getElementById('judge-competition').value = '';
            document.getElementById('judge-courtroom').value = '';
            document.getElementById('judge-round').value = '';
            document.getElementById('judge-password').value = '';
            document.getElementById('judge-name').value = '';
            
            // Reset session
            currentJudgeSession = {
                petitionerSubmitted: false,
                respondentSubmitted: false,
                assignment: null
            };
            
            // Reset tabs
            document.getElementById('petitioner-tab').classList.add('active', 'text-blue-600', 'border-blue-600');
            document.getElementById('respondent-tab').classList.remove('active', 'text-red-600', 'border-red-600');
            document.getElementById('respondent-tab').classList.add('text-gray-400', 'cursor-not-allowed');
            document.getElementById('respondent-tab').disabled = true;
            
            showTeamTab('petitioner');
        }

        // Court Manager Portal Functions
        function loadManagersForLogin() {
            const select = document.getElementById('manager-login-name');
            select.innerHTML = '<option value="">Select Manager...</option>';
            
            // Get unique manager names from court assignments
            const managers = [...new Set(courtAssignments.map(a => a.managerName))];
            managers.forEach(manager => {
                const option = document.createElement('option');
                option.value = manager;
                option.textContent = manager;
                select.appendChild(option);
            });
        }

        function managerLogin() {
            const name = document.getElementById('manager-login-name').value;
            const password = document.getElementById('manager-login-password').value;
            const round = document.getElementById('manager-round').value;
            
            if (!name || !password || !round) {
                alert('Please fill in all fields');
                return;
            }
            
            // Find matching assignment
            const assignment = courtAssignments.find(a => 
                a.managerName === name && 
                a.managerPassword === password && 
                a.round === round
            );
            
            if (!assignment) {
                alert('Invalid credentials or round selection');
                return;
            }
            
            // Check if timekeeping is already completed for this assignment
            const existingTimeData = timekeepingData.find(t => t.assignmentId == assignment.id);
            if (existingTimeData) {
                // Show completion message
                document.getElementById('manager-login').classList.add('hidden');
                document.getElementById('manager-timekeeping').classList.add('hidden');
                document.getElementById('manager-thankyou').classList.add('hidden');
                
                // Create and show completion status
                const completionDiv = document.createElement('div');
                completionDiv.id = 'manager-completed';
                completionDiv.className = 'text-center';
                completionDiv.innerHTML = `
                    <div class="text-6xl mb-4">‚úÖ</div>
                    <h3 class="text-2xl font-bold text-green-600 mb-2">Timekeeping Already Completed!</h3>
                    <p class="text-gray-600 mb-4">This court's timekeeping has been submitted and cannot be redone.</p>
                    <div class="bg-green-50 p-4 rounded-lg mb-4">
                        <div class="text-sm text-green-700">
                            <div><strong>Court:</strong> ${assignment.courtNumber}</div>
                            <div><strong>Round:</strong> ${assignment.round}</div>
                            <div><strong>Completed on:</strong> ${new Date(existingTimeData.timestamp).toLocaleString()}</div>
                            <div><strong>Manager:</strong> ${assignment.managerName}</div>
                        </div>
                    </div>
                    <button onclick="resetManagerPortal()" class="bg-orange-600 text-white py-3 px-6 rounded-lg hover:bg-orange-700 transition-colors font-medium">Back to Login</button>
                `;
                
                document.getElementById('manager-timekeeping').parentNode.appendChild(completionDiv);
                return;
            }
            
            const competition = competitions.find(c => c.id == assignment.competitionId);
            
            // Show timekeeping interface
            document.getElementById('manager-login').classList.add('hidden');
            document.getElementById('manager-timekeeping').classList.remove('hidden');
            
            // Populate court info
            document.getElementById('manager-court-info').innerHTML = `
                <div class="grid md:grid-cols-4 gap-4 text-sm">
                    <div><strong>Competition:</strong> ${competition.competitionName}</div>
                    <div><strong>Court:</strong> ${assignment.courtNumber}</div>
                    <div><strong>Round:</strong> ${assignment.round}</div>
                    <div><strong>Manager:</strong> ${name}</div>
                </div>
                <div class="grid md:grid-cols-2 gap-4 mt-2 text-sm">
                    <div><strong>Petitioner:</strong> ${assignment.petitionerTeam}</div>
                    <div><strong>Respondent:</strong> ${assignment.respondentTeam}</div>
                </div>
            `;
            
            // Store current assignment for timer
            window.currentManagerAssignment = assignment;
            
            // Add event listeners for time calculation
            ['pet-speaker1-time', 'pet-speaker2-time', 'pet-rebuttal-time'].forEach(id => {
                document.getElementById(id).addEventListener('input', updatePetitionerTotal);
            });
            
            ['res-speaker1-time', 'res-speaker2-time', 'res-rebuttal-time'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateRespondentTotal);
            });
        }

        function updatePetitionerTotal() {
            const speaker1 = parseInt(document.getElementById('pet-speaker1-time').value) || 0;
            const speaker2 = parseInt(document.getElementById('pet-speaker2-time').value) || 0;
            const rebuttal = parseInt(document.getElementById('pet-rebuttal-time').value) || 0;
            const total = speaker1 + speaker2 + rebuttal;
            
            document.getElementById('pet-total-time').textContent = total;
            const statusElement = document.getElementById('pet-total-status');
            
            if (total === 30) {
                statusElement.textContent = '‚úì Perfect';
                statusElement.className = 'ml-2 text-green-600 font-bold';
            } else if (total > 30) {
                statusElement.textContent = '‚ö†Ô∏è Over limit';
                statusElement.className = 'ml-2 text-red-600 font-bold';
            } else {
                statusElement.textContent = '‚ö†Ô∏è Under 30 min';
                statusElement.className = 'ml-2 text-orange-600 font-bold';
            }
            
            checkTimekeepingReady();
        }

        function updateRespondentTotal() {
            const speaker1 = parseInt(document.getElementById('res-speaker1-time').value) || 0;
            const speaker2 = parseInt(document.getElementById('res-speaker2-time').value) || 0;
            const rebuttal = parseInt(document.getElementById('res-rebuttal-time').value) || 0;
            const total = speaker1 + speaker2 + rebuttal;
            
            document.getElementById('res-total-time').textContent = total;
            const statusElement = document.getElementById('res-total-status');
            
            if (total === 30) {
                statusElement.textContent = '‚úì Perfect';
                statusElement.className = 'ml-2 text-green-600 font-bold';
            } else if (total > 30) {
                statusElement.textContent = '‚ö†Ô∏è Over limit';
                statusElement.className = 'ml-2 text-red-600 font-bold';
            } else {
                statusElement.textContent = '‚ö†Ô∏è Under 30 min';
                statusElement.className = 'ml-2 text-orange-600 font-bold';
            }
            
            checkTimekeepingReady();
        }

        function checkTimekeepingReady() {
            const petTotal = parseInt(document.getElementById('pet-total-time').textContent) || 0;
            const resTotal = parseInt(document.getElementById('res-total-time').textContent) || 0;
            const startButton = document.getElementById('start-timekeeping-btn');
            
            if (petTotal > 0 && resTotal > 0) {
                startButton.disabled = false;
                startButton.classList.remove('bg-gray-400');
                startButton.classList.add('bg-green-600', 'hover:bg-green-700');
            } else {
                startButton.disabled = true;
                startButton.classList.add('bg-gray-400');
                startButton.classList.remove('bg-green-600', 'hover:bg-green-700');
            }
        }

        function startTimekeeping() {
            const petSpeaker1 = parseInt(document.getElementById('pet-speaker1-time').value) || 0;
            const petSpeaker2 = parseInt(document.getElementById('pet-speaker2-time').value) || 0;
            const petRebuttal = parseInt(document.getElementById('pet-rebuttal-time').value) || 0;
            const resSpeaker1 = parseInt(document.getElementById('res-speaker1-time').value) || 0;
            const resSpeaker2 = parseInt(document.getElementById('res-speaker2-time').value) || 0;
            const resRebuttal = parseInt(document.getElementById('res-rebuttal-time').value) || 0;
            
            // Initialize timer state with proper moot court sequence (convert to milliseconds)
            timerState.speakers = [
                { name: 'Petitioner Speaker 1', time: petSpeaker1 * 60000, team: 'petitioner', type: 'speaker1' },
                { name: 'Petitioner Speaker 2', time: petSpeaker2 * 60000, team: 'petitioner', type: 'speaker2' },
                { name: 'Respondent Speaker 1', time: resSpeaker1 * 60000, team: 'respondent', type: 'speaker1' },
                { name: 'Respondent Speaker 2', time: resSpeaker2 * 60000, team: 'respondent', type: 'speaker2' },
                { name: 'Petitioner Rebuttal', time: petRebuttal * 60000, team: 'petitioner', type: 'rebuttal' },
                { name: 'Respondent Sur-Rebuttal', time: resRebuttal * 60000, team: 'respondent', type: 'surrebuttal' }
            ];
            
            timerState.currentSpeaker = 0;
            timerState.timeRemaining = timerState.speakers[0].time;
            timerState.extraTime = 0;
            timerState.isRunning = false;
            timerState.speakerStartTimes = [];
            timerState.speakerEndTimes = [];
            timerState.actualStartTime = null;
            
            // Hide time allocation, show timekeeping panel
            document.getElementById('time-allocation').classList.add('hidden');
            document.getElementById('timekeeping-panel').classList.remove('hidden');
            
            updateTimerDisplay();
            updateSubmissionStatus();
        }

        function updateTimerDisplay() {
            const totalMilliseconds = Math.abs(timerState.timeRemaining);
            const minutes = Math.floor(totalMilliseconds / 60000);
            const seconds = Math.floor((totalMilliseconds % 60000) / 1000);
            const milliseconds = Math.floor((totalMilliseconds % 1000) / 10);
            
            const timeString = `${timerState.timeRemaining < 0 ? '-' : ''}${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}:${milliseconds.toString().padStart(2, '0')}`;
            
            document.getElementById('timer-clock').textContent = timeString;
            document.getElementById('current-speaker').textContent = timerState.speakers[timerState.currentSpeaker].name;
            document.getElementById('speaker-progress').textContent = `Speaker ${timerState.currentSpeaker + 1} of ${timerState.speakers.length}`;
            
            // Time indicators (in milliseconds)
            const totalTime = timerState.speakers[timerState.currentSpeaker].time + timerState.extraTime;
            const elapsed = totalTime - timerState.timeRemaining;
            const indicatorElement = document.getElementById('timer-indicator');
            
            if (timerState.timeRemaining <= 0) {
                indicatorElement.textContent = 'üî¥ TIME UP!';
                indicatorElement.className = 'text-lg font-bold text-red-400 animate-pulse';
            } else if (timerState.timeRemaining <= 60000) { // Last 1 minute
                indicatorElement.textContent = 'üü° LAST 1 MINUTE';
                indicatorElement.className = 'text-lg font-bold text-yellow-400';
            } else if (timerState.timeRemaining <= 180000) { // Last 3 minutes
                indicatorElement.textContent = 'üü† LAST 3 MINUTES';
                indicatorElement.className = 'text-lg font-bold text-orange-400';
            } else if (elapsed >= Math.floor(totalTime / 2) && elapsed < Math.floor(totalTime / 2) + 5000) { // Half time (5 second window)
                indicatorElement.textContent = 'üîµ HALF TIME';
                indicatorElement.className = 'text-lg font-bold text-blue-400';
            } else {
                indicatorElement.textContent = '';
                indicatorElement.className = 'text-lg font-bold';
            }
            
            // Color coding for timer (in milliseconds)
            const clockElement = document.getElementById('timer-clock');
            if (timerState.timeRemaining < 0) {
                clockElement.className = 'text-6xl font-bold mb-2 text-red-400 animate-pulse';
            } else if (timerState.timeRemaining <= 60000) { // Last minute
                clockElement.className = 'text-6xl font-bold mb-2 text-yellow-400';
            } else if (timerState.timeRemaining <= 180000) { // Last 3 minutes
                clockElement.className = 'text-6xl font-bold mb-2 text-orange-400';
            } else {
                clockElement.className = 'text-6xl font-bold mb-2 text-white';
            }
        }

        function startTimer() {
            if (!timerState.isRunning) {
                timerState.isRunning = true;
                timerState.actualStartTime = Date.now();
                timerState.speakerStartTimes[timerState.currentSpeaker] = new Date().toISOString();
                
                document.getElementById('start-timer-btn').disabled = true;
                document.getElementById('stop-timer-btn').disabled = false;
                document.getElementById('next-speaker-btn').disabled = false;
                
                currentTimer = setInterval(() => {
                    timerState.timeRemaining -= 10; // Decrease by 10ms for precision
                    updateTimerDisplay();
                    
                    const totalTime = timerState.speakers[timerState.currentSpeaker].time + timerState.extraTime;
                    const elapsed = totalTime - timerState.timeRemaining;
                    
                    // Bell alerts (convert to milliseconds)
                    if (Math.abs(elapsed - Math.floor(totalTime / 2)) < 50) {
                        playBell(1); // Half time - short bell
                    } else if (Math.abs(timerState.timeRemaining - 180000) < 50) {
                        playBell(1); // 3 minutes left - short bell
                    } else if (Math.abs(timerState.timeRemaining - 60000) < 50) {
                        playBell(1); // 1 minute left - short bell
                    } else if (timerState.timeRemaining <= 0 && timerState.timeRemaining > -50) {
                        playBell(5); // Time up - long bell
                    }
                }, 10); // Update every 10ms for millisecond precision
            }
        }

        function stopTimer() {
            if (timerState.isRunning) {
                timerState.isRunning = false;
                clearInterval(currentTimer);
                
                document.getElementById('start-timer-btn').disabled = false;
                document.getElementById('stop-timer-btn').disabled = true;
                
                // Record end time for current speaker
                timerState.speakerEndTimes[timerState.currentSpeaker] = new Date().toISOString();
                
                // Update submission status
                updateSubmissionStatus();
            }
        }

        function nextSpeaker() {
            // Stop current timer if running
            if (timerState.isRunning) {
                stopTimer();
            }
            
            // Record end time for current speaker if not already recorded
            if (!timerState.speakerEndTimes[timerState.currentSpeaker]) {
                timerState.speakerEndTimes[timerState.currentSpeaker] = new Date().toISOString();
            }
            
            if (timerState.currentSpeaker < timerState.speakers.length - 1) {
                timerState.currentSpeaker++;
                timerState.timeRemaining = timerState.speakers[timerState.currentSpeaker].time;
                timerState.extraTime = 0;
                
                // Enable start button for next speaker
                document.getElementById('start-timer-btn').disabled = false;
                document.getElementById('stop-timer-btn').disabled = true;
                
                updateTimerDisplay();
                updateSubmissionStatus();
                alert(`Ready for ${timerState.speakers[timerState.currentSpeaker].name}. Click START when ready.`);
            } else {
                // All speakers finished
                alert('All 6 speakers have completed their arguments! You can now submit the timekeeping data.');
                document.getElementById('submit-timekeeping-btn').classList.remove('hidden');
                document.getElementById('next-speaker-btn').disabled = true;
                updateSubmissionStatus();
            }
        }

        function updateSubmissionStatus() {
            const statusDiv = document.getElementById('submission-status');
            const completedSpeakers = timerState.speakerEndTimes.filter(time => time !== undefined).length;
            const totalSpeakers = timerState.speakers.length;
            
            if (completedSpeakers === totalSpeakers) {
                statusDiv.innerHTML = `
                    <div class="text-green-600 font-bold">
                        ‚úÖ All ${totalSpeakers} speakers completed! Ready to submit.
                    </div>
                `;
                document.getElementById('submit-timekeeping-btn').classList.remove('hidden');
            } else {
                statusDiv.innerHTML = `
                    <div class="text-orange-600">
                        üìä Progress: ${completedSpeakers}/${totalSpeakers} speakers completed
                        <br>
                        <span class="text-sm">‚ö†Ô∏è All speakers must complete before submission</span>
                    </div>
                `;
                document.getElementById('submit-timekeeping-btn').classList.add('hidden');
            }
        }

        function addExtraTime(seconds) {
            const milliseconds = seconds * 1000;
            timerState.extraTime += milliseconds;
            timerState.timeRemaining += milliseconds;
            updateTimerDisplay();
        }

        function playBell(duration) {
            // Visual bell effect
            document.querySelector('.timer-display').classList.add('timer-bell');
            setTimeout(() => {
                document.querySelector('.timer-display').classList.remove('timer-bell');
            }, 500);
            
            // Audio would go here if supported
            console.log(`üîî Bell ringing for ${duration} seconds`);
        }

        function submitTimekeeping() {
            if (!window.currentManagerAssignment) {
                alert('No active session found');
                return;
            }
            
            const timekeepingEntry = {
                id: Date.now(),
                assignmentId: window.currentManagerAssignment.id,
                competitionId: window.currentManagerAssignment.competitionId,
                timestamp: new Date().toISOString(),
                courtNumber: window.currentManagerAssignment.courtNumber,
                round: window.currentManagerAssignment.round,
                petitionerTeam: window.currentManagerAssignment.petitionerTeam,
                respondentTeam: window.currentManagerAssignment.respondentTeam,
                speakers: timerState.speakers.map((speaker, index) => ({
                    name: speaker.name,
                    team: speaker.team,
                    type: speaker.type,
                    allocatedTime: speaker.time,
                    allocatedMinutes: Math.floor(speaker.time / 60000),
                    startTime: timerState.speakerStartTimes[index] || null,
                    endTime: timerState.speakerEndTimes[index] || null,
                    actualDuration: (timerState.speakerStartTimes[index] && timerState.speakerEndTimes[index]) ? 
                        new Date(timerState.speakerEndTimes[index]) - new Date(timerState.speakerStartTimes[index]) : null,
                    extraTime: index === timerState.currentSpeaker ? timerState.extraTime : 0,
                    sequence: index + 1
                })),
                petitionerTimes: {
                    speaker1: parseInt(document.getElementById('pet-speaker1-time').value),
                    speaker2: parseInt(document.getElementById('pet-speaker2-time').value),
                    rebuttal: parseInt(document.getElementById('pet-rebuttal-time').value)
                },
                respondentTimes: {
                    speaker1: parseInt(document.getElementById('res-speaker1-time').value),
                    speaker2: parseInt(document.getElementById('res-speaker2-time').value),
                    rebuttal: parseInt(document.getElementById('res-rebuttal-time').value)
                },
                totalSessionTime: timerState.actualStartTime ? Date.now() - timerState.actualStartTime : null
            };
            
            timekeepingData.push(timekeepingEntry);
            localStorage.setItem('timekeepingData', JSON.stringify(timekeepingData));
            
            // Stop timer if running
            if (timerState.isRunning) {
                stopTimer();
            }
            
            // Show thank you screen
            document.getElementById('manager-timekeeping').classList.add('hidden');
            document.getElementById('manager-thankyou').classList.remove('hidden');
        }

        function resetManagerPortal() {
            document.getElementById('manager-thankyou').classList.add('hidden');
            document.getElementById('manager-login').classList.remove('hidden');
            
            // Remove completion div if it exists
            const completionDiv = document.getElementById('manager-completed');
            if (completionDiv) {
                completionDiv.remove();
            }
            
            // Reset form
            document.getElementById('manager-login-name').value = '';
            document.getElementById('manager-login-password').value = '';
            document.getElementById('manager-round').value = '';
            
            // Reset timer state
            timerState = {
                currentSpeaker: 0,
                timeRemaining: 0,
                speakers: [],
                extraTime: 0,
                isRunning: false,
                startTime: null,
                speakerStartTimes: [],
                speakerEndTimes: []
            };
            
            // Show time allocation again
            document.getElementById('time-allocation').classList.remove('hidden');
            document.getElementById('timekeeping-panel').classList.add('hidden');
            document.getElementById('submit-timekeeping-btn').classList.add('hidden');
            
            // Clear submission status
            const statusDiv = document.getElementById('submission-status');
            if (statusDiv) {
                statusDiv.innerHTML = '';
            }
            
            // Clear timer
            if (currentTimer) {
                clearInterval(currentTimer);
            }
        }

        // Dashboard Portal Functions
        function loadCompetitionsForDashboard() {
            const select = document.getElementById('dashboard-competition');
            select.innerHTML = '<option value="">Choose a competition...</option>';
            
            competitions.forEach(comp => {
                const option = document.createElement('option');
                option.value = comp.id;
                option.textContent = `${comp.competitionName} - ${comp.collegeName}`;
                select.appendChild(option);
            });
        }

        function loadDashboard() {
            const competitionId = document.getElementById('dashboard-competition').value;
            if (!competitionId) {
                document.getElementById('dashboard-content').classList.add('hidden');
                return;
            }
            
            const competition = competitions.find(c => c.id == competitionId);
            if (!competition) {
                alert('Competition not found!');
                return;
            }
            
            document.getElementById('dashboard-content').classList.remove('hidden');
            
            // Generate round tabs
            const tabsContainer = document.getElementById('round-tabs');
            tabsContainer.innerHTML = '';
            
            const rounds = Object.keys(competition.rounds).filter(round => competition.rounds[round]);
            
            // Add qualitative tab if both prelims exist
            if (competition.rounds.prelims1 && competition.rounds.prelims2) {
                const qualitativeButton = document.createElement('button');
                qualitativeButton.className = 'px-4 py-2 font-medium text-indigo-600 border-b-2 border-indigo-600';
                qualitativeButton.textContent = 'Qualitative Score';
                qualitativeButton.onclick = () => showQualitativeRankings(competitionId, qualitativeButton);
                tabsContainer.appendChild(qualitativeButton);
            }
            
            // Add best speakers tab
            const bestSpeakersButton = document.createElement('button');
            bestSpeakersButton.className = 'px-4 py-2 font-medium text-gray-500 hover:text-indigo-600';
            bestSpeakersButton.textContent = 'Best Speakers';
            bestSpeakersButton.onclick = () => showBestSpeakers(competitionId, bestSpeakersButton);
            tabsContainer.appendChild(bestSpeakersButton);
            
            rounds.forEach((round, index) => {
                const button = document.createElement('button');
                const isFirst = index === 0 && tabsContainer.children.length === 1; // Only first if no qualitative tab
                button.className = `px-4 py-2 font-medium ${isFirst ? 'text-indigo-600 border-b-2 border-indigo-600' : 'text-gray-500 hover:text-indigo-600'}`;
                button.textContent = round.charAt(0).toUpperCase() + round.slice(1);
                button.onclick = () => showRoundRankings(competitionId, round, button);
                tabsContainer.appendChild(button);
            });
            
            // Show qualitative by default if available, otherwise first round
            if (competition.rounds.prelims1 && competition.rounds.prelims2) {
                showQualitativeRankings(competitionId, tabsContainer.firstChild);
            } else if (rounds.length > 0) {
                showRoundRankings(competitionId, rounds[0], tabsContainer.children[1] || tabsContainer.lastChild);
            } else {
                document.getElementById('rankings-content').innerHTML = '<p class="text-gray-500 text-center py-8">No rounds configured for this competition.</p>';
            }
        }

        function showRoundRankings(competitionId, round, buttonElement) {
            // Update active tab
            document.querySelectorAll('#round-tabs button').forEach(btn => {
                btn.className = 'px-4 py-2 font-medium text-gray-500 hover:text-indigo-600';
            });
            buttonElement.className = 'px-4 py-2 font-medium text-indigo-600 border-b-2 border-indigo-600';
            
            // Get assignments for this competition and round
            const assignments = courtAssignments.filter(a => a.competitionId == competitionId && a.round === round);
            
            if (assignments.length === 0) {
                document.getElementById('rankings-content').innerHTML = '<p class="text-gray-500 text-center py-8">No data available for this round.</p>';
                return;
            }
            
            // Calculate rankings
            const rankings = calculateRankings(assignments, round);
            
            // Display rankings
            displayRankings(rankings, round, competitionId);
        }

        function calculateRankings(assignments, round) {
            const teamScores = {};
            
            assignments.forEach(assignment => {
                // Get scores for this assignment
                const scores = judgeScores.filter(s => s.assignmentId == assignment.id);
                
                // Get timekeeping data
                const timeData = timekeepingData.find(t => t.assignmentId == assignment.id);
                
                // Initialize team scores if not exists
                if (!teamScores[assignment.petitionerTeam]) {
                    teamScores[assignment.petitionerTeam] = { totalScore: 0, judgeCount: 0, totalTime: 0, team: assignment.petitionerTeam };
                }
                if (!teamScores[assignment.respondentTeam]) {
                    teamScores[assignment.respondentTeam] = { totalScore: 0, judgeCount: 0, totalTime: 0, team: assignment.respondentTeam };
                }
                
                // Add timekeeping data
                if (timeData) {
                    teamScores[assignment.petitionerTeam].totalTime += 
                        timeData.petitionerTimes.speaker1 + timeData.petitionerTimes.speaker2 + timeData.petitionerTimes.rebuttal;
                    teamScores[assignment.respondentTeam].totalTime += 
                        timeData.respondentTimes.speaker1 + timeData.respondentTimes.speaker2 + timeData.respondentTimes.rebuttal;
                }
                
                // Calculate scores from judges
                scores.forEach(scoreData => {
                    const teamType = scoreData.team;
                    const teamCode = teamType === 'petitioner' ? assignment.petitionerTeam : assignment.respondentTeam;
                    const teamScore = calculateTeamScore(scoreData.scores, teamType);
                    
                    teamScores[teamCode].totalScore += teamScore;
                    teamScores[teamCode].judgeCount++;
                });
            });
            
            // Calculate averages and sort
            const rankings = Object.values(teamScores).map(team => ({
                ...team,
                averageScore: team.judgeCount > 0 ? team.totalScore / team.judgeCount : 0
            })).sort((a, b) => {
                if (a.averageScore !== b.averageScore) {
                    return b.averageScore - a.averageScore;
                }
                // Tie-breaker: shorter time wins
                return a.totalTime - b.totalTime;
            });
            
            return rankings;
        }

        function calculateTeamScore(scores, team) {
            let total = 0;
            
            for (let speaker = 1; speaker <= 2; speaker++) {
                total += parseInt(scores[`${team}-speaker${speaker}-perusal`] || 0);
                total += parseInt(scores[`${team}-speaker${speaker}-knowledge`] || 0);
                total += parseInt(scores[`${team}-speaker${speaker}-organization`] || 0);
                total += parseInt(scores[`${team}-speaker${speaker}-clarity`] || 0);
                total += parseInt(scores[`${team}-speaker${speaker}-persuasiveness`] || 0);
                total += parseInt(scores[`${team}-speaker${speaker}-coordination`] || 0);
                total += parseInt(scores[`${team}-speaker${speaker}-etiquette`] || 0);
            }
            
            return total;
        }

        function showQualitativeRankings(competitionId, buttonElement) {
            // Update active tab
            document.querySelectorAll('#round-tabs button').forEach(btn => {
                btn.className = 'px-4 py-2 font-medium text-gray-500 hover:text-indigo-600';
            });
            buttonElement.className = 'px-4 py-2 font-medium text-indigo-600 border-b-2 border-indigo-600';
            
            const competition = competitions.find(c => c.id == competitionId);
            
            // Get assignments for both prelims
            const prelims1Assignments = courtAssignments.filter(a => a.competitionId == competitionId && a.round === 'prelims1');
            const prelims2Assignments = courtAssignments.filter(a => a.competitionId == competitionId && a.round === 'prelims2');
            
            // Calculate combined rankings
            const teamScores = {};
            
            // Process both prelims
            [prelims1Assignments, prelims2Assignments].forEach(assignments => {
                assignments.forEach(assignment => {
                    const scores = judgeScores.filter(s => s.assignmentId == assignment.id);
                    const timeData = timekeepingData.find(t => t.assignmentId == assignment.id);
                    
                    // Initialize team scores
                    [assignment.petitionerTeam, assignment.respondentTeam].forEach(teamCode => {
                        if (!teamScores[teamCode]) {
                            teamScores[teamCode] = { totalScore: 0, judgeCount: 0, totalTime: 0, team: teamCode };
                        }
                    });
                    
                    // Add timekeeping data
                    if (timeData) {
                        teamScores[assignment.petitionerTeam].totalTime += 
                            timeData.petitionerTimes.speaker1 + timeData.petitionerTimes.speaker2 + timeData.petitionerTimes.rebuttal;
                        teamScores[assignment.respondentTeam].totalTime += 
                            timeData.respondentTimes.speaker1 + timeData.respondentTimes.speaker2 + timeData.respondentTimes.rebuttal;
                    }
                    
                    // Add scores
                    scores.forEach(scoreData => {
                        const teamType = scoreData.team;
                        const teamCode = teamType === 'petitioner' ? assignment.petitionerTeam : assignment.respondentTeam;
                        const teamScore = calculateTeamScore(scoreData.scores, teamType);
                        
                        teamScores[teamCode].totalScore += teamScore;
                        teamScores[teamCode].judgeCount++;
                    });
                });
            });
            
            // Calculate averages and sort
            const rankings = Object.values(teamScores).map(team => ({
                ...team,
                averageScore: team.judgeCount > 0 ? team.totalScore / team.judgeCount : 0
            })).sort((a, b) => {
                if (a.averageScore !== b.averageScore) {
                    return b.averageScore - a.averageScore;
                }
                return a.totalTime - b.totalTime;
            });
            
            // Determine qualification numbers
            let qualifyingTeams = 4; // Default for semi finals
            if (competition.rounds.octa) qualifyingTeams = 16;
            else if (competition.rounds.quarters) qualifyingTeams = 8;
            
            displayQualitativeRankings(rankings, qualifyingTeams, competitionId);
        }

        function displayQualitativeRankings(rankings, qualifyingTeams, competitionId) {
            const container = document.getElementById('rankings-content');
            
            if (rankings.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No qualitative rankings data available.</p>';
                return;
            }
            
            let html = `
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="px-6 py-4 bg-indigo-50 border-b">
                        <div class="flex justify-between items-center">
                            <div>
                                <h3 class="text-lg font-bold text-indigo-700">Qualitative Score Rankings (Combined Prelims 1 & 2)</h3>
                                <p class="text-sm text-indigo-600 mt-1">Top ${qualifyingTeams} teams qualify for next round</p>
                            </div>
                            <button onclick="exportQualitativeRankingsPDF(${competitionId}, ${qualifyingTeams})" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium">üìÑ Export PDF</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Team</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Combined Score</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Time</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
            `;
            
            rankings.forEach((team, index) => {
                const isQualified = index < qualifyingTeams;
                const rowClass = isQualified ? 'bg-yellow-50' : 'bg-red-50';
                const statusText = isQualified ? '‚úÖ QUALIFIED' : '‚ùå ELIMINATED';
                const statusClass = isQualified ? 'text-green-600 font-bold' : 'text-red-600 font-bold';
                
                html += `
                    <tr class="${rowClass}">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            ${index + 1}
                            ${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : ''}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium">
                            <button onclick="showTeamScoresheet('${team.team}', ${competitionId})" class="text-blue-600 hover:text-blue-900 underline">${team.team}</button>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${team.averageScore.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${team.totalTime} min</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm ${statusClass}">${statusText}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="exportTeamPDF('${team.team}')" class="text-green-600 hover:text-green-900">Export PDF</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function displayRankings(rankings, round, competitionId) {
            const container = document.getElementById('rankings-content');
            
            if (rankings.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No rankings data available for this round.</p>';
                return;
            }
            
            let html = `
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="px-6 py-4 bg-indigo-50 border-b">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-bold text-indigo-700">${round.charAt(0).toUpperCase() + round.slice(1)} Rankings</h3>
                            <button onclick="exportRoundRankingsPDF('${round}', ${competitionId})" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium">üìÑ Export PDF</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Team</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Average Score</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Time</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
            `;
            
            rankings.forEach((team, index) => {
                html += `
                    <tr class="${index < 3 ? 'bg-yellow-50' : ''}">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            ${index + 1}
                            ${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : ''}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium">
                            <button onclick="showTeamScoresheet('${team.team}', ${competitionId})" class="text-blue-600 hover:text-blue-900 underline">${team.team}</button>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${team.averageScore.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${team.totalTime} min</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="exportTeamPDF('${team.team}')" class="text-green-600 hover:text-green-900">Export PDF</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function showBestSpeakers(competitionId, buttonElement) {
            // Update active tab
            document.querySelectorAll('#round-tabs button').forEach(btn => {
                btn.className = 'px-4 py-2 font-medium text-gray-500 hover:text-indigo-600';
            });
            buttonElement.className = 'px-4 py-2 font-medium text-indigo-600 border-b-2 border-indigo-600';
            
            // Get all assignments for this competition
            const assignments = courtAssignments.filter(a => a.competitionId == competitionId);
            const speakerScores = {};
            
            assignments.forEach(assignment => {
                const scores = judgeScores.filter(s => s.assignmentId == assignment.id);
                
                scores.forEach(scoreData => {
                    const teamType = scoreData.team;
                    const teamCode = teamType === 'petitioner' ? assignment.petitionerTeam : assignment.respondentTeam;
                    
                    for (let speaker = 1; speaker <= 2; speaker++) {
                        const prefix = `${teamType}-speaker${speaker}`;
                        const gender = scoreData.scores[`${prefix}-gender`];
                        
                        if (gender) {
                            const speakerKey = `${teamCode}-Speaker${speaker}`;
                            
                            if (!speakerScores[speakerKey]) {
                                speakerScores[speakerKey] = {
                                    name: `${teamCode} Speaker ${speaker}`,
                                    team: teamCode,
                                    gender: gender,
                                    totalScore: 0,
                                    judgeCount: 0,
                                    rounds: []
                                };
                            }
                            
                            const speakerScore = 
                                parseInt(scoreData.scores[`${prefix}-perusal`] || 0) +
                                parseInt(scoreData.scores[`${prefix}-knowledge`] || 0) +
                                parseInt(scoreData.scores[`${prefix}-organization`] || 0) +
                                parseInt(scoreData.scores[`${prefix}-clarity`] || 0) +
                                parseInt(scoreData.scores[`${prefix}-persuasiveness`] || 0) +
                                parseInt(scoreData.scores[`${prefix}-coordination`] || 0) +
                                parseInt(scoreData.scores[`${prefix}-etiquette`] || 0);
                            
                            speakerScores[speakerKey].totalScore += speakerScore;
                            speakerScores[speakerKey].judgeCount++;
                            speakerScores[speakerKey].rounds.push({
                                round: assignment.round,
                                score: speakerScore,
                                judge: scoreData.judgeName
                            });
                        }
                    }
                });
            });
            
            // Calculate averages and separate by gender
            const maleRankings = [];
            const femaleRankings = [];
            
            Object.values(speakerScores).forEach(speaker => {
                const avgScore = speaker.judgeCount > 0 ? speaker.totalScore / speaker.judgeCount : 0;
                const speakerData = { ...speaker, averageScore: avgScore };
                
                if (speaker.gender === 'Male') {
                    maleRankings.push(speakerData);
                } else if (speaker.gender === 'Female') {
                    femaleRankings.push(speakerData);
                }
            });
            
            // Sort by average score
            maleRankings.sort((a, b) => b.averageScore - a.averageScore);
            femaleRankings.sort((a, b) => b.averageScore - a.averageScore);
            
            // Store current rankings globally for PDF export
            window.currentMaleRankings = maleRankings;
            window.currentFemaleRankings = femaleRankings;
            
            displayBestSpeakers(maleRankings, femaleRankings);
        }
        
        function displayBestSpeakers(maleRankings, femaleRankings) {
            const container = document.getElementById('rankings-content');
            
            let html = `
                <div class="mb-4 flex justify-end">
                    <button onclick="exportBestSpeakersPDF()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium">üìÑ Export Best Speakers PDF</button>
                </div>
                <div class="space-y-6">
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 bg-blue-50 border-b">
                            <h3 class="text-lg font-bold text-blue-700">üèÜ Best Male Speakers</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Speaker</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Team</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Average Score</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rounds</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
            `;
            
            maleRankings.forEach((speaker, index) => {
                const rowClass = index < 3 ? 'bg-yellow-50' : '';
                html += `
                    <tr class="${rowClass}">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            ${index + 1}
                            ${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : ''}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium">${speaker.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${speaker.team}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${speaker.averageScore.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${speaker.judgeCount} rounds</td>
                    </tr>
                `;
            });
            
            html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="px-6 py-4 bg-pink-50 border-b">
                            <h3 class="text-lg font-bold text-pink-700">üèÜ Best Female Speakers</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rank</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Speaker</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Team</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Average Score</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rounds</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
            `;
            
            femaleRankings.forEach((speaker, index) => {
                const rowClass = index < 3 ? 'bg-yellow-50' : '';
                html += `
                    <tr class="${rowClass}">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            ${index + 1}
                            ${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : ''}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium">${speaker.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${speaker.team}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${speaker.averageScore.toFixed(2)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${speaker.judgeCount} rounds</td>
                    </tr>
                `;
            });
            
            html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        function showTeamScoresheet(teamCode, competitionId) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
            
            let content = `
                <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b">
                        <div class="flex justify-between items-center">
                            <h3 class="text-2xl font-bold text-gray-800">üìä Team ${teamCode} - Complete Scoresheet</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                        </div>
                    </div>
                    <div class="p-6 space-y-6">
            `;
            
            // Find all assignments for this team
            const teamAssignments = courtAssignments.filter(a => 
                (a.petitionerTeam === teamCode || a.respondentTeam === teamCode) && 
                a.competitionId == competitionId
            );
            
            teamAssignments.forEach(assignment => {
                const competition = competitions.find(c => c.id == assignment.competitionId);
                const scores = judgeScores.filter(s => s.assignmentId == assignment.id);
                const timeEntry = timekeepingData.find(t => t.assignmentId == assignment.id);
                const isTeam = assignment.petitionerTeam === teamCode ? 'petitioner' : 'respondent';
                const opponent = assignment.petitionerTeam === teamCode ? assignment.respondentTeam : assignment.petitionerTeam;
                
                content += `
                    <div class="border rounded-lg p-4 bg-gray-50">
                        <h4 class="text-lg font-bold mb-3">${assignment.round.toUpperCase()} - Court ${assignment.courtNumber}</h4>
                        <p class="text-sm text-gray-600 mb-4">vs ${opponent} | Competition: ${competition.competitionName}</p>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                `;
                
                // Show scores from each judge
                scores.forEach(score => {
                    if (score.team === isTeam) {
                        content += `
                            <div class="bg-white p-4 rounded border">
                                <h5 class="font-bold mb-3">Judge: ${score.judgeName}</h5>
                                <div class="text-xs text-gray-500 mb-3">Scored on: ${new Date(score.timestamp).toLocaleString()}</div>
                        `;
                        
                        for (let speaker = 1; speaker <= 2; speaker++) {
                            const prefix = `${isTeam}-speaker${speaker}`;
                            const gender = score.scores[`${prefix}-gender`] || 'N/A';
                            
                            let speakerTotal = 0;
                            const fields = ['perusal', 'knowledge', 'organization', 'clarity', 'persuasiveness', 'coordination', 'etiquette'];
                            fields.forEach(field => {
                                speakerTotal += parseInt(score.scores[`${prefix}-${field}`] || 0);
                            });
                            
                            content += `
                                <div class="mb-3 p-2 bg-gray-50 rounded">
                                    <div class="font-medium">Speaker ${speaker} (${gender}) - Total: ${speakerTotal}/110</div>
                                    <div class="text-xs grid grid-cols-2 gap-1 mt-1">
                                        <div>Perusal: ${score.scores[`${prefix}-perusal`] || 'N/A'}/10</div>
                                        <div>Knowledge: ${score.scores[`${prefix}-knowledge`] || 'N/A'}/20</div>
                                        <div>Organization: ${score.scores[`${prefix}-organization`] || 'N/A'}/20</div>
                                        <div>Clarity: ${score.scores[`${prefix}-clarity`] || 'N/A'}/20</div>
                                        <div>Persuasiveness: ${score.scores[`${prefix}-persuasiveness`] || 'N/A'}/20</div>
                                        <div>Coordination: ${score.scores[`${prefix}-coordination`] || 'N/A'}/10</div>
                                        <div>Etiquette: ${score.scores[`${prefix}-etiquette`] || 'N/A'}/10</div>
                                    </div>
                                </div>
                            `;
                        }
                        
                        content += `</div>`;
                    }
                });
                
                // Show timing data
                if (timeEntry) {
                    const times = isTeam === 'petitioner' ? timeEntry.petitionerTimes : timeEntry.respondentTimes;
                    const speakers = timeEntry.speakers.filter(s => s.team === isTeam);
                    
                    content += `
                        <div class="bg-white p-4 rounded border">
                            <h5 class="font-bold mb-3">‚è±Ô∏è Timing Data</h5>
                            <div class="text-xs text-gray-500 mb-3">Court ${timeEntry.courtNumber} | Recorded on: ${new Date(timeEntry.timestamp).toLocaleString()}</div>
                            <div class="space-y-2">
                                <div><strong>Allocated Time:</strong></div>
                                <div class="ml-4">Speaker 1: ${times.speaker1} minutes</div>
                                <div class="ml-4">Speaker 2: ${times.speaker2} minutes</div>
                                <div class="ml-4">${isTeam === 'petitioner' ? 'Rebuttal' : 'Sur-Rebuttal'}: ${times.rebuttal} minutes</div>
                                <div class="font-bold">Total Allocated: ${times.speaker1 + times.speaker2 + times.rebuttal} minutes</div>
                            </div>
                            
                            <div class="mt-4 text-xs">
                                <div class="font-medium mb-2">üìÖ Speaking Sequence & Timestamps:</div>
                                <div class="space-y-1">
                    `;
                    
                    // Sort speakers by sequence to show proper order
                    const sortedSpeakers = speakers.sort((a, b) => a.sequence - b.sequence);
                    
                    sortedSpeakers.forEach((speaker) => {
                        if (speaker.startTime && speaker.endTime) {
                            const start = new Date(speaker.startTime).toLocaleTimeString();
                            const end = new Date(speaker.endTime).toLocaleTimeString();
                            const actualMinutes = Math.floor(speaker.actualDuration / 60000);
                            const actualSeconds = Math.floor((speaker.actualDuration % 60000) / 1000);
                            const actualTime = `${actualMinutes}:${actualSeconds.toString().padStart(2, '0')}`;
                            
                            content += `
                                <div class="bg-gray-50 p-2 rounded text-xs">
                                    <div class="font-medium">${speaker.sequence}. ${speaker.name}</div>
                                    <div class="text-gray-600">
                                        üïê ${start} - ${end} | 
                                        ‚è±Ô∏è Actual: ${actualTime} | 
                                        üìã Allocated: ${speaker.allocatedMinutes} min
                                        ${speaker.extraTime > 0 ? ` | ‚ûï Extra: ${Math.floor(speaker.extraTime/60000)} min` : ''}
                                    </div>
                                </div>
                            `;
                        } else {
                            content += `
                                <div class="bg-red-50 p-2 rounded text-xs">
                                    <div class="font-medium text-red-600">${speaker.sequence}. ${speaker.name}</div>
                                    <div class="text-red-500">‚ö†Ô∏è No timing data recorded</div>
                                </div>
                            `;
                        }
                    });
                    
                    // Show total session time if available
                    if (timeEntry.totalSessionTime) {
                        const sessionMinutes = Math.floor(timeEntry.totalSessionTime / 60000);
                        const sessionSeconds = Math.floor((timeEntry.totalSessionTime % 60000) / 1000);
                        content += `
                            <div class="mt-2 p-2 bg-blue-50 rounded">
                                <div class="font-medium text-blue-700">üìä Total Session Duration: ${sessionMinutes}:${sessionSeconds.toString().padStart(2, '0')}</div>
                            </div>
                        `;
                    }
                    
                    content += `
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                content += `
                        </div>
                    </div>
                `;
            });
            
            content += `
                    </div>
                    <div class="p-6 border-t bg-gray-50 flex justify-end space-x-3">
                        <button onclick="exportTeamPDF('${teamCode}')" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Export PDF</button>
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">Close</button>
                    </div>
                </div>
            `;
            
            modal.innerHTML = content;
            document.body.appendChild(modal);
        }

        function exportTeamPDF(teamCode) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            let yPosition = 20;
            const pageHeight = doc.internal.pageSize.height;
            const margin = 20;
            
            // Helper function to add new page if needed
            function checkPageBreak(neededSpace = 20) {
                if (yPosition + neededSpace > pageHeight - margin) {
                    doc.addPage();
                    yPosition = 20;
                }
            }
            
            // Helper function to add text with word wrap
            function addText(text, x, y, options = {}) {
                const fontSize = options.fontSize || 10;
                const maxWidth = options.maxWidth || 170;
                const isBold = options.bold || false;
                
                doc.setFontSize(fontSize);
                doc.setFont('helvetica', isBold ? 'bold' : 'normal');
                
                const lines = doc.splitTextToSize(text, maxWidth);
                lines.forEach((line, index) => {
                    checkPageBreak();
                    doc.text(line, x, y + (index * (fontSize * 0.4)));
                    yPosition = Math.max(yPosition, y + (index * (fontSize * 0.4)) + 5);
                });
                
                return yPosition;
            }
            
            // Title
            yPosition = addText('MOOT COURT JUDGING SYSTEM', 20, yPosition, { fontSize: 16, bold: true });
            yPosition = addText('COMPLETE SCORESHEET REPORT', 20, yPosition + 5, { fontSize: 14, bold: true });
            yPosition += 10;
            
            // Team info
            yPosition = addText(`Team: ${teamCode}`, 20, yPosition, { fontSize: 12, bold: true });
            yPosition = addText(`Report Generated: ${new Date().toLocaleString()}`, 20, yPosition + 5, { fontSize: 10 });
            yPosition += 15;
            
            let totalTeamScore = 0;
            let totalJudges = 0;
            let totalAllocatedTime = 0;
            let roundCount = 0;
            
            // Find team data across all competitions
            courtAssignments.forEach(assignment => {
                if (assignment.petitionerTeam === teamCode || assignment.respondentTeam === teamCode) {
                    const scores = judgeScores.filter(s => s.assignmentId == assignment.id);
                    const timeEntry = timekeepingData.find(t => t.assignmentId == assignment.id);
                    const competition = competitions.find(c => c.id == assignment.competitionId);
                    const isTeam = assignment.petitionerTeam === teamCode ? 'petitioner' : 'respondent';
                    const opponent = assignment.petitionerTeam === teamCode ? assignment.respondentTeam : assignment.petitionerTeam;
                    
                    roundCount++;
                    checkPageBreak(30);
                    
                    // Round header
                    yPosition = addText(`ROUND ${roundCount}: ${assignment.round.toUpperCase()}`, 20, yPosition, { fontSize: 12, bold: true });
                    yPosition += 5;
                    
                    // Round details
                    yPosition = addText(`Competition: ${competition ? competition.competitionName : 'Unknown'}`, 20, yPosition);
                    yPosition = addText(`College: ${competition ? competition.collegeName : 'Unknown'}`, 20, yPosition + 5);
                    yPosition = addText(`Date: ${competition ? competition.date : 'N/A'}`, 20, yPosition + 5);
                    yPosition = addText(`Court Number: ${assignment.courtNumber}`, 20, yPosition + 5);
                    yPosition = addText(`Team Role: ${isTeam.toUpperCase()}`, 20, yPosition + 5);
                    yPosition = addText(`Opponent: ${opponent}`, 20, yPosition + 5);
                    yPosition = addText(`Judges: ${assignment.judges.map(j => j.fullName).join(', ')}`, 20, yPosition + 5);
                    yPosition += 10;
                    
                    // Judge scores
                    scores.forEach(score => {
                        if (score.team === isTeam) {
                            checkPageBreak(40);
                            yPosition = addText(`JUDGE: ${score.judgeName}`, 25, yPosition, { bold: true });
                            yPosition = addText(`SCORED ON: ${new Date(score.timestamp).toLocaleString()}`, 25, yPosition + 5);
                            yPosition += 10;
                            
                            let judgeTeamTotal = 0;
                            
                            for (let speaker = 1; speaker <= 2; speaker++) {
                                const prefix = `${isTeam}-speaker${speaker}`;
                                const gender = score.scores[`${prefix}-gender`] || 'N/A';
                                
                                let speakerTotal = 0;
                                const fields = [
                                    { name: 'perusal', max: 10, label: 'Perusal of Facts' },
                                    { name: 'knowledge', max: 20, label: 'Knowledge and Application of Law' },
                                    { name: 'organization', max: 20, label: 'Organization and Presentation' },
                                    { name: 'clarity', max: 20, label: 'Clarity of Thought, Legal Reasoning' },
                                    { name: 'persuasiveness', max: 20, label: 'Persuasiveness and Response to Questions' },
                                    { name: 'coordination', max: 10, label: 'Team Coordination and Time Management' },
                                    { name: 'etiquette', max: 10, label: 'Courtroom Etiquette' }
                                ];
                                
                                checkPageBreak(25);
                                yPosition = addText(`SPEAKER ${speaker} (${gender}):`, 30, yPosition, { bold: true });
                                yPosition += 5;
                                
                                fields.forEach(field => {
                                    const scoreValue = parseInt(score.scores[`${prefix}-${field.name}`] || 0);
                                    speakerTotal += scoreValue;
                                    yPosition = addText(`${field.label}: ${scoreValue}/${field.max}`, 35, yPosition + 3);
                                });
                                
                                yPosition = addText(`SPEAKER ${speaker} TOTAL: ${speakerTotal}/110`, 30, yPosition + 5, { bold: true });
                                yPosition += 10;
                                judgeTeamTotal += speakerTotal;
                            }
                            
                            yPosition = addText(`TEAM TOTAL FROM ${score.judgeName}: ${judgeTeamTotal}/220`, 25, yPosition, { bold: true });
                            yPosition += 15;
                            totalTeamScore += judgeTeamTotal;
                            totalJudges++;
                        }
                    });
                    
                    // Timing data
                    if (timeEntry) {
                        const times = isTeam === 'petitioner' ? timeEntry.petitionerTimes : timeEntry.respondentTimes;
                        const speakers = timeEntry.speakers.filter(s => s.team === isTeam);
                        
                        checkPageBreak(30);
                        yPosition = addText('TIMING DATA & SPEAKING SEQUENCE:', 25, yPosition, { bold: true });
                        yPosition = addText(`Recorded on: ${new Date(timeEntry.timestamp).toLocaleString()}`, 25, yPosition + 5);
                        yPosition = addText(`Court Manager: ${assignment.managerName}`, 25, yPosition + 5);
                        yPosition += 10;
                        
                        yPosition = addText('Allocated Time:', 30, yPosition, { bold: true });
                        yPosition = addText(`Speaker 1: ${times.speaker1} minutes`, 35, yPosition + 5);
                        yPosition = addText(`Speaker 2: ${times.speaker2} minutes`, 35, yPosition + 5);
                        yPosition = addText(`${isTeam === 'petitioner' ? 'Rebuttal' : 'Sur-Rebuttal'}: ${times.rebuttal} minutes`, 35, yPosition + 5);
                        yPosition = addText(`Total Allocated: ${times.speaker1 + times.speaker2 + times.rebuttal} minutes`, 35, yPosition + 5, { bold: true });
                        yPosition += 10;
                        
                        yPosition = addText('Speaking Sequence & Actual Performance:', 30, yPosition, { bold: true });
                        yPosition += 5;
                        
                        // Sort speakers by sequence
                        const sortedSpeakers = speakers.sort((a, b) => a.sequence - b.sequence);
                        
                        sortedSpeakers.forEach(speaker => {
                            checkPageBreak(20);
                            if (speaker.startTime && speaker.endTime) {
                                const start = new Date(speaker.startTime).toLocaleTimeString();
                                const end = new Date(speaker.endTime).toLocaleTimeString();
                                const actualMinutes = Math.floor(speaker.actualDuration / 60000);
                                const actualSeconds = Math.floor((speaker.actualDuration % 60000) / 1000);
                                const actualTime = `${actualMinutes}:${actualSeconds.toString().padStart(2, '0')}`;
                                
                                yPosition = addText(`${speaker.sequence}. ${speaker.name}:`, 35, yPosition, { bold: true });
                                yPosition = addText(`Start: ${start} | End: ${end}`, 40, yPosition + 4);
                                yPosition = addText(`Allocated: ${speaker.allocatedMinutes} min | Actual: ${actualTime}`, 40, yPosition + 4);
                                if (speaker.extraTime > 0) {
                                    yPosition = addText(`Extra Time: ${Math.floor(speaker.extraTime/60000)} minutes`, 40, yPosition + 4);
                                }
                                yPosition += 8;
                            } else {
                                yPosition = addText(`${speaker.sequence}. ${speaker.name}: NO TIMING DATA`, 35, yPosition);
                                yPosition += 5;
                            }
                        });
                        
                        if (timeEntry.totalSessionTime) {
                            const sessionMinutes = Math.floor(timeEntry.totalSessionTime / 60000);
                            const sessionSeconds = Math.floor((timeEntry.totalSessionTime % 60000) / 1000);
                            yPosition = addText(`Total Session Duration: ${sessionMinutes}:${sessionSeconds.toString().padStart(2, '0')}`, 30, yPosition + 5, { bold: true });
                        }
                        
                        totalAllocatedTime += times.speaker1 + times.speaker2 + times.rebuttal;
                    }
                    
                    yPosition += 15;
                }
            });
            
            // Summary
            checkPageBreak(50);
            yPosition = addText(`OVERALL PERFORMANCE SUMMARY FOR TEAM ${teamCode}`, 20, yPosition, { fontSize: 12, bold: true });
            yPosition += 10;
            yPosition = addText(`Total Rounds Participated: ${roundCount}`, 20, yPosition);
            yPosition = addText(`Total Judges Evaluated: ${totalJudges}`, 20, yPosition + 5);
            yPosition = addText(`Combined Score Across All Rounds: ${totalTeamScore} points`, 20, yPosition + 5);
            yPosition = addText(`Average Score Per Judge: ${totalJudges > 0 ? (totalTeamScore / totalJudges).toFixed(2) : 'N/A'}/220`, 20, yPosition + 5);
            yPosition = addText(`Total Time Allocated: ${totalAllocatedTime} minutes`, 20, yPosition + 5);
            yPosition = addText(`Average Time Per Round: ${roundCount > 0 ? (totalAllocatedTime / roundCount).toFixed(1) : 'N/A'} minutes`, 20, yPosition + 5);
            
            // Save PDF
            doc.save(`Team_${teamCode}_Complete_Scoresheet_${new Date().toISOString().split('T')[0]}.pdf`);
            
            alert(`üìÑ PDF scoresheet for Team ${teamCode} exported successfully!\n\nüìã Report includes:\n‚úÖ All judge scores with detailed breakdown\n‚è±Ô∏è Complete timing data with speaking sequence\nüë• Speaker-wise performance analysis\nüìä Overall performance summary\n\nüíæ File saved as PDF format`);
        }

        function exportQualitativeRankingsPDF(competitionId, qualifyingTeams) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const competition = competitions.find(c => c.id == competitionId);
            if (!competition) {
                alert('Competition not found!');
                return;
            }
            
            let yPosition = 20;
            
            // Title
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('MOOT COURT JUDGING SYSTEM', 20, yPosition);
            yPosition += 10;
            
            doc.setFontSize(14);
            doc.text('QUALITATIVE SCORE RANKINGS', 20, yPosition);
            yPosition += 15;
            
            // Competition details
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(`Competition: ${competition.competitionName}`, 20, yPosition);
            yPosition += 7;
            doc.text(`College: ${competition.collegeName}`, 20, yPosition);
            yPosition += 7;
            doc.text(`Date: ${competition.date}`, 20, yPosition);
            yPosition += 7;
            doc.text(`Report Generated: ${new Date().toLocaleString()}`, 20, yPosition);
            yPosition += 15;
            
            // Get qualitative rankings
            const prelims1Assignments = courtAssignments.filter(a => a.competitionId == competitionId && a.round === 'prelims1');
            const prelims2Assignments = courtAssignments.filter(a => a.competitionId == competitionId && a.round === 'prelims2');
            
            const teamScores = {};
            
            [prelims1Assignments, prelims2Assignments].forEach(assignments => {
                assignments.forEach(assignment => {
                    const scores = judgeScores.filter(s => s.assignmentId == assignment.id);
                    const timeData = timekeepingData.find(t => t.assignmentId == assignment.id);
                    
                    [assignment.petitionerTeam, assignment.respondentTeam].forEach(teamCode => {
                        if (!teamScores[teamCode]) {
                            teamScores[teamCode] = { totalScore: 0, judgeCount: 0, totalTime: 0, team: teamCode };
                        }
                    });
                    
                    if (timeData) {
                        teamScores[assignment.petitionerTeam].totalTime += 
                            timeData.petitionerTimes.speaker1 + timeData.petitionerTimes.speaker2 + timeData.petitionerTimes.rebuttal;
                        teamScores[assignment.respondentTeam].totalTime += 
                            timeData.respondentTimes.speaker1 + timeData.respondentTimes.speaker2 + timeData.respondentTimes.rebuttal;
                    }
                    
                    scores.forEach(scoreData => {
                        const teamType = scoreData.team;
                        const teamCode = teamType === 'petitioner' ? assignment.petitionerTeam : assignment.respondentTeam;
                        const teamScore = calculateTeamScore(scoreData.scores, teamType);
                        
                        teamScores[teamCode].totalScore += teamScore;
                        teamScores[teamCode].judgeCount++;
                    });
                });
            });
            
            const rankings = Object.values(teamScores).map(team => ({
                ...team,
                averageScore: team.judgeCount > 0 ? team.totalScore / team.judgeCount : 0
            })).sort((a, b) => {
                if (a.averageScore !== b.averageScore) {
                    return b.averageScore - a.averageScore;
                }
                return a.totalTime - b.totalTime;
            });
            
            // Rankings header
            doc.setFont('helvetica', 'bold');
            doc.text(`COMBINED PRELIMS 1 & 2 RANKINGS (Top ${qualifyingTeams} Qualify)`, 20, yPosition);
            yPosition += 10;
            
            // Table headers
            doc.setFontSize(10);
            doc.text('Rank', 20, yPosition);
            doc.text('Team Code', 50, yPosition);
            doc.text('Combined Score', 100, yPosition);
            doc.text('Total Time', 140, yPosition);
            doc.text('Status', 170, yPosition);
            yPosition += 5;
            
            // Draw line
            doc.line(20, yPosition, 190, yPosition);
            yPosition += 5;
            
            // Rankings data
            doc.setFont('helvetica', 'normal');
            rankings.forEach((team, index) => {
                if (yPosition > 270) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                const isQualified = index < qualifyingTeams;
                const status = isQualified ? 'QUALIFIED' : 'ELIMINATED';
                
                doc.text(`${index + 1}`, 20, yPosition);
                doc.text(team.team, 50, yPosition);
                doc.text(team.averageScore.toFixed(2), 100, yPosition);
                doc.text(`${team.totalTime} min`, 140, yPosition);
                doc.text(status, 170, yPosition);
                yPosition += 7;
            });
            
            // Save PDF
            doc.save(`Qualitative_Rankings_${competition.competitionName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`);
            
            alert('üìÑ Qualitative Rankings PDF exported successfully!');
        }

        function exportRoundRankingsPDF(round, competitionId) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const competition = competitions.find(c => c.id == competitionId);
            if (!competition) {
                alert('Competition not found!');
                return;
            }
            
            let yPosition = 20;
            
            // Title
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('MOOT COURT JUDGING SYSTEM', 20, yPosition);
            yPosition += 10;
            
            doc.setFontSize(14);
            doc.text(`${round.toUpperCase()} ROUND RANKINGS`, 20, yPosition);
            yPosition += 15;
            
            // Competition details
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(`Competition: ${competition.competitionName}`, 20, yPosition);
            yPosition += 7;
            doc.text(`College: ${competition.collegeName}`, 20, yPosition);
            yPosition += 7;
            doc.text(`Date: ${competition.date}`, 20, yPosition);
            yPosition += 7;
            doc.text(`Report Generated: ${new Date().toLocaleString()}`, 20, yPosition);
            yPosition += 15;
            
            // Get round rankings
            const assignments = courtAssignments.filter(a => a.competitionId == competitionId && a.round === round);
            const rankings = calculateRankings(assignments, round);
            
            // Rankings header
            doc.setFont('helvetica', 'bold');
            doc.text(`${round.toUpperCase()} ROUND RESULTS`, 20, yPosition);
            yPosition += 10;
            
            // Table headers
            doc.setFontSize(10);
            doc.text('Rank', 20, yPosition);
            doc.text('Team Code', 50, yPosition);
            doc.text('Average Score', 100, yPosition);
            doc.text('Total Time', 140, yPosition);
            doc.text('Judges', 170, yPosition);
            yPosition += 5;
            
            // Draw line
            doc.line(20, yPosition, 190, yPosition);
            yPosition += 5;
            
            // Rankings data
            doc.setFont('helvetica', 'normal');
            rankings.forEach((team, index) => {
                if (yPosition > 270) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.text(`${index + 1}`, 20, yPosition);
                doc.text(team.team, 50, yPosition);
                doc.text(team.averageScore.toFixed(2), 100, yPosition);
                doc.text(`${team.totalTime} min`, 140, yPosition);
                doc.text(`${team.judgeCount}`, 170, yPosition);
                yPosition += 7;
            });
            
            // Add detailed court information
            yPosition += 10;
            doc.setFont('helvetica', 'bold');
            doc.text('COURT ASSIGNMENTS:', 20, yPosition);
            yPosition += 10;
            
            doc.setFont('helvetica', 'normal');
            assignments.forEach(assignment => {
                if (yPosition > 260) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.text(`Court ${assignment.courtNumber}: ${assignment.petitionerTeam} vs ${assignment.respondentTeam}`, 20, yPosition);
                yPosition += 5;
                doc.text(`Judges: ${assignment.judges.map(j => j.fullName).join(', ')}`, 25, yPosition);
                yPosition += 10;
            });
            
            // Save PDF
            doc.save(`${round.charAt(0).toUpperCase() + round.slice(1)}_Rankings_${competition.competitionName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`);
            
            alert(`üìÑ ${round.charAt(0).toUpperCase() + round.slice(1)} Round Rankings PDF exported successfully!`);
        }

        function exportBestSpeakersPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const competitionId = document.getElementById('dashboard-competition').value;
            const competition = competitions.find(c => c.id == competitionId);
            
            if (!competition) {
                alert('Please select a competition first!');
                return;
            }
            
            let yPosition = 20;
            
            // Title
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('MOOT COURT JUDGING SYSTEM', 20, yPosition);
            yPosition += 10;
            
            doc.setFontSize(14);
            doc.text('BEST SPEAKERS RANKINGS', 20, yPosition);
            yPosition += 15;
            
            // Competition details
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(`Competition: ${competition.competitionName}`, 20, yPosition);
            yPosition += 7;
            doc.text(`College: ${competition.collegeName}`, 20, yPosition);
            yPosition += 7;
            doc.text(`Date: ${competition.date}`, 20, yPosition);
            yPosition += 7;
            doc.text(`Report Generated: ${new Date().toLocaleString()}`, 20, yPosition);
            yPosition += 15;
            
            // Get speaker data
            const assignments = courtAssignments.filter(a => a.competitionId == competitionId);
            const speakerScores = {};
            
            assignments.forEach(assignment => {
                const scores = judgeScores.filter(s => s.assignmentId == assignment.id);
                
                scores.forEach(scoreData => {
                    const teamType = scoreData.team;
                    const teamCode = teamType === 'petitioner' ? assignment.petitionerTeam : assignment.respondentTeam;
                    
                    for (let speaker = 1; speaker <= 2; speaker++) {
                        const prefix = `${teamType}-speaker${speaker}`;
                        const gender = scoreData.scores[`${prefix}-gender`];
                        
                        if (gender) {
                            const speakerKey = `${teamCode}-Speaker${speaker}`;
                            
                            if (!speakerScores[speakerKey]) {
                                speakerScores[speakerKey] = {
                                    name: `${teamCode} Speaker ${speaker}`,
                                    team: teamCode,
                                    gender: gender,
                                    totalScore: 0,
                                    judgeCount: 0,
                                    rounds: []
                                };
                            }
                            
                            const speakerScore = 
                                parseInt(scoreData.scores[`${prefix}-perusal`] || 0) +
                                parseInt(scoreData.scores[`${prefix}-knowledge`] || 0) +
                                parseInt(scoreData.scores[`${prefix}-organization`] || 0) +
                                parseInt(scoreData.scores[`${prefix}-clarity`] || 0) +
                                parseInt(scoreData.scores[`${prefix}-persuasiveness`] || 0) +
                                parseInt(scoreData.scores[`${prefix}-coordination`] || 0) +
                                parseInt(scoreData.scores[`${prefix}-etiquette`] || 0);
                            
                            speakerScores[speakerKey].totalScore += speakerScore;
                            speakerScores[speakerKey].judgeCount++;
                            speakerScores[speakerKey].rounds.push({
                                round: assignment.round,
                                score: speakerScore,
                                judge: scoreData.judgeName
                            });
                        }
                    }
                });
            });
            
            // Separate by gender
            const maleRankings = [];
            const femaleRankings = [];
            
            Object.values(speakerScores).forEach(speaker => {
                const avgScore = speaker.judgeCount > 0 ? speaker.totalScore / speaker.judgeCount : 0;
                const speakerData = { ...speaker, averageScore: avgScore };
                
                if (speaker.gender === 'Male') {
                    maleRankings.push(speakerData);
                } else if (speaker.gender === 'Female') {
                    femaleRankings.push(speakerData);
                }
            });
            
            maleRankings.sort((a, b) => b.averageScore - a.averageScore);
            femaleRankings.sort((a, b) => b.averageScore - a.averageScore);
            
            // Male speakers section
            doc.setFont('helvetica', 'bold');
            doc.text('BEST MALE SPEAKERS', 20, yPosition);
            yPosition += 10;
            
            // Table headers
            doc.setFontSize(10);
            doc.text('Rank', 20, yPosition);
            doc.text('Speaker', 50, yPosition);
            doc.text('Team', 100, yPosition);
            doc.text('Avg Score', 130, yPosition);
            doc.text('Rounds', 160, yPosition);
            yPosition += 5;
            
            doc.line(20, yPosition, 190, yPosition);
            yPosition += 5;
            
            doc.setFont('helvetica', 'normal');
            maleRankings.forEach((speaker, index) => {
                if (yPosition > 270) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.text(`${index + 1}`, 20, yPosition);
                doc.text(speaker.name, 50, yPosition);
                doc.text(speaker.team, 100, yPosition);
                doc.text(speaker.averageScore.toFixed(2), 130, yPosition);
                doc.text(`${speaker.judgeCount}`, 160, yPosition);
                yPosition += 7;
            });
            
            yPosition += 15;
            
            // Female speakers section
            if (yPosition > 200) {
                doc.addPage();
                yPosition = 20;
            }
            
            doc.setFont('helvetica', 'bold');
            doc.text('BEST FEMALE SPEAKERS', 20, yPosition);
            yPosition += 10;
            
            // Table headers
            doc.setFontSize(10);
            doc.text('Rank', 20, yPosition);
            doc.text('Speaker', 50, yPosition);
            doc.text('Team', 100, yPosition);
            doc.text('Avg Score', 130, yPosition);
            doc.text('Rounds', 160, yPosition);
            yPosition += 5;
            
            doc.line(20, yPosition, 190, yPosition);
            yPosition += 5;
            
            doc.setFont('helvetica', 'normal');
            femaleRankings.forEach((speaker, index) => {
                if (yPosition > 270) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.text(`${index + 1}`, 20, yPosition);
                doc.text(speaker.name, 50, yPosition);
                doc.text(speaker.team, 100, yPosition);
                doc.text(speaker.averageScore.toFixed(2), 130, yPosition);
                doc.text(`${speaker.judgeCount}`, 160, yPosition);
                yPosition += 7;
            });
            
            // Save PDF
            doc.save(`Best_Speakers_${competition.competitionName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`);
            
            alert('üìÑ Best Speakers PDF exported successfully!');
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            showPortal('home');
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96829d788036f424',t:'MTc1NDAyMjc4My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
